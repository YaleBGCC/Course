<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Data Wrangling</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="cm_yeti_bootswatch.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}

.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Ecology, Statistics, and Data Science with R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="Head2_Schedule.html">Schedule</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Course Materials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Head1_CourseContent.html">About Course Content</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Module 1: Introduction to R</li>
    <li>
      <a href="00_CourseIntroductionFrame.html">1.0 Course Introduction</a>
    </li>
    <li>
      <a href="01_Rintro.html">1.1 First Steps</a>
    </li>
    <li>
      <a href="02_DataWrangling.html">1.2 Data Wrangling</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Module 2: Spatial Analysis in R</li>
    <li>
      <a href="04_Spatial.html">2.1 Spatial Data</a>
    </li>
    <li>
      <a href="05_Raster.html">2.2 Spatial Raster Data</a>
    </li>
    <li>
      <a href="06_RasterTwo.html">2.3 More Raster Data</a>
    </li>
    <li class="divider"></li>
    <li class="divider"></li>
  </ul>
</li>
<li>
  <a href="Head3_Resources.html">Resources</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/cmerow/RDataScience/tree/gh-pages">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Data Wrangling</h1>

</div>


<!-- <div> -->
<!-- <object data="02_assets/02_DataWrangling.pdf" type="application/pdf" width="100%" height="600px">  -->
<!--   <p>It appears you don't have a PDF plugin for this browser. -->
<!--    No biggie... you can <a href="02_assets/02_DataWrangling.pdf">click here to -->
<!--   download the PDF file.</a></p>   -->
<!--  </object> -->
<!--  </div> -->
<!--  <p><a href="02_assets/02_DataWrangling.pdf">Download the PDF of the presentation</a></p>   -->
<p><a href="02_DataWrangling.R"><i class="fa fa-file-code-o fa-3x" aria-hidden="true"></i> The R Script associated with this page is available here</a>. Download this file and open it (or copy-paste into a new script) with RStudio so you can follow along.</p>
<div id="rstudio-shortcuts" class="section level1">
<h1><span class="header-section-number">1</span> RStudio Shortcuts</h1>
<div id="running-code" class="section level2">
<h2><span class="header-section-number">1.1</span> Running code</h2>
<ul>
<li><code>ctrl-R</code> (or <code>command-R</code>) to run current line</li>
<li>Highlight <code>code</code> in script and run <code>ctrl-R</code> (or <code>command-R</code>) to run selection</li>
<li>Buttons: <img src="02_assets/Source.png" style="width: 25%"/></li>
</ul>
</div>
<div id="switching-windows" class="section level2">
<h2><span class="header-section-number">1.2</span> Switching windows</h2>
<ul>
<li><code>ctrl-1</code>: script window</li>
<li><code>ctrl-2</code>: console window</li>
</ul>
<blockquote>
<p>Try to run today’s script without using your mouse/trackpad</p>
</blockquote>
</div>
</div>
<div id="data-wrangling" class="section level1">
<h1><span class="header-section-number">2</span> Data wrangling</h1>
<div id="useful-packages-dplyr-and-tidyr" class="section level2">
<h2><span class="header-section-number">2.1</span> Useful packages: <a href="https://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html"><code>dplyr</code></a> and <a href=""><code>tidyr</code></a></h2>
<p><a href="https://www.rstudio.com/resources/cheatsheets/">Cheat sheets on website</a> for <a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">Data Wrangling</a></p>
<pre class="r"><code>library(dplyr)
library(tidyr)</code></pre>
<p>Remember use <code>install.packages(&quot;dplyr&quot;)</code> to install a new package.</p>
<div id="example-operations-from-here" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Example operations from <a href="https://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html">here</a></h3>
</div>
</div>
<div id="new-york-city-flights" class="section level2">
<h2><span class="header-section-number">2.2</span> New York City Flights</h2>
<p>Data from <a href="http://www.transtats.bts.gov/DatabaseInfo.asp?DB_ID=120&amp;Link=0">US Bureau of Transportation Statistics</a> (see <code>?nycflights13</code>)</p>
<pre class="r"><code>library(nycflights13)</code></pre>
<p>Check out the <code>flights</code> object</p>
<pre class="r"><code>head(flights)</code></pre>
<pre><code>## # A tibble: 6 × 19
##    year month   day dep_time sched_dep_time
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;
## 1  2013     1     1      517            515
## 2  2013     1     1      533            529
## 3  2013     1     1      542            540
## 4  2013     1     1      544            545
## 5  2013     1     1      554            600
## 6  2013     1     1      554            558
## # ... with 14 more variables: dep_delay &lt;dbl&gt;,
## #   arr_time &lt;int&gt;, sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div id="object-structure" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Object <em>Structure</em></h3>
<p>Check out data <em>structure</em> with <code>glimpse()</code></p>
<pre class="r"><code>glimpse(flights)</code></pre>
<pre><code>## Observations: 336,776
## Variables: 19
## $ year           &lt;int&gt; 2013, 2013, 2013, 2013...
## $ month          &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1...
## $ day            &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1...
## $ dep_time       &lt;int&gt; 517, 533, 542, 544, 55...
## $ sched_dep_time &lt;int&gt; 515, 529, 540, 545, 60...
## $ dep_delay      &lt;dbl&gt; 2, 4, 2, -1, -6, -4, -...
## $ arr_time       &lt;int&gt; 830, 850, 923, 1004, 8...
## $ sched_arr_time &lt;int&gt; 819, 830, 850, 1022, 8...
## $ arr_delay      &lt;dbl&gt; 11, 20, 33, -18, -25, ...
## $ carrier        &lt;chr&gt; &quot;UA&quot;, &quot;UA&quot;, &quot;AA&quot;, &quot;B6&quot;...
## $ flight         &lt;int&gt; 1545, 1714, 1141, 725,...
## $ tailnum        &lt;chr&gt; &quot;N14228&quot;, &quot;N24211&quot;, &quot;N...
## $ origin         &lt;chr&gt; &quot;EWR&quot;, &quot;LGA&quot;, &quot;JFK&quot;, &quot;...
## $ dest           &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;MIA&quot;, &quot;...
## $ air_time       &lt;dbl&gt; 227, 227, 160, 183, 11...
## $ distance       &lt;dbl&gt; 1400, 1416, 1089, 1576...
## $ hour           &lt;dbl&gt; 5, 5, 5, 5, 6, 5, 6, 6...
## $ minute         &lt;dbl&gt; 15, 29, 40, 45, 0, 58,...
## $ time_hour      &lt;dttm&gt; 2013-01-01 05:00:00, ...</code></pre>
</div>
</div>
</div>
<div id="dplyr-verbs" class="section level1">
<h1><span class="header-section-number">3</span> <code>dplyr</code> “verbs”</h1>
<ul>
<li><code>select()</code> and <code>rename()</code>: Extract existing variables</li>
<li><code>filter()</code> and <code>slice()</code>: Extract existing observations</li>
<li><code>arrange()</code></li>
<li><code>distinct()</code></li>
<li><code>mutate()</code> and <code>transmute()</code>: Derive new variables</li>
<li><code>summarise()</code>: Change the unit of analysis</li>
<li><code>sample_n()</code> and <code>sample_frac()</code></li>
</ul>
<div id="useful-select-functions" class="section level2">
<h2><span class="header-section-number">3.1</span> Useful select functions</h2>
<ul>
<li>“<code>-</code>” Select everything but</li>
<li>“<code>:</code>” Select range</li>
<li><code>contains()</code> Select columns whose name contains a character string</li>
<li><code>ends_with()</code> Select columns whose name ends with a string</li>
<li><code>everything()</code> Select every column</li>
<li><code>matches()</code> Select columns whose name matches a regular expression</li>
<li><code>num_range()</code> Select columns named x1, x2, x3, x4, x5</li>
<li><code>one_of()</code> Select columns whose names are in a group of names</li>
<li><code>starts_with()</code> Select columns whose name starts with a character string</li>
</ul>
<div id="select-examples" class="section level3">
<h3><span class="header-section-number">3.1.1</span> <code>select()</code> examples</h3>
<p>Select only the <code>year</code>, <code>month</code>, and <code>day</code> columns:</p>
<pre class="r"><code>select(flights,year, month, day)</code></pre>
<pre><code>## # A tibble: 336,776 × 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1   2013     1     1
## 2   2013     1     1
## 3   2013     1     1
## 4   2013     1     1
## 5   2013     1     1
## 6   2013     1     1
## 7   2013     1     1
## 8   2013     1     1
## 9   2013     1     1
## 10  2013     1     1
## # ... with 336,766 more rows</code></pre>
</div>
<div id="select-examples-1" class="section level3">
<h3><span class="header-section-number">3.1.2</span> <code>select()</code> examples</h3>
<p>Select everything <em>except</em> the <code>tailnum</code>:</p>
<pre class="r"><code>select(flights,-tailnum)</code></pre>
<pre><code>## # A tibble: 336,776 × 18
##     year month   day dep_time sched_dep_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;
## 1   2013     1     1      517            515
## 2   2013     1     1      533            529
## 3   2013     1     1      542            540
## 4   2013     1     1      544            545
## 5   2013     1     1      554            600
## 6   2013     1     1      554            558
## 7   2013     1     1      555            600
## 8   2013     1     1      557            600
## 9   2013     1     1      557            600
## 10  2013     1     1      558            600
## # ... with 336,766 more rows, and 13 more
## #   variables: dep_delay &lt;dbl&gt;, arr_time &lt;int&gt;,
## #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, origin &lt;chr&gt;,
## #   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Select all columns containing the string <code>&quot;time&quot;</code>:</p>
<pre class="r"><code>select(flights,contains(&quot;time&quot;))</code></pre>
<pre><code>## # A tibble: 336,776 × 6
##    dep_time sched_dep_time arr_time
##       &lt;int&gt;          &lt;int&gt;    &lt;int&gt;
## 1       517            515      830
## 2       533            529      850
## 3       542            540      923
## 4       544            545     1004
## 5       554            600      812
## 6       554            558      740
## 7       555            600      913
## 8       557            600      709
## 9       557            600      838
## 10      558            600      753
## # ... with 336,766 more rows, and 3 more
## #   variables: sched_arr_time &lt;int&gt;,
## #   air_time &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>You can also rename columns with <code>select()</code></p>
<pre class="r"><code>select(flights,year,carrier,destination=dest)</code></pre>
<pre><code>## # A tibble: 336,776 × 3
##     year carrier destination
##    &lt;int&gt;   &lt;chr&gt;       &lt;chr&gt;
## 1   2013      UA         IAH
## 2   2013      UA         IAH
## 3   2013      AA         MIA
## 4   2013      B6         BQN
## 5   2013      DL         ATL
## 6   2013      UA         ORD
## 7   2013      B6         FLL
## 8   2013      EV         IAD
## 9   2013      B6         MCO
## 10  2013      AA         ORD
## # ... with 336,766 more rows</code></pre>
</div>
</div>
<div id="filter-observations" class="section level2">
<h2><span class="header-section-number">3.2</span> <code>filter()</code> observations</h2>
<p>Filter all flights that departed on on January 1st:</p>
<pre class="r"><code>filter(flights, month == 1, day == 1)</code></pre>
<pre><code>## # A tibble: 842 × 19
##     year month   day dep_time sched_dep_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;
## 1   2013     1     1      517            515
## 2   2013     1     1      533            529
## 3   2013     1     1      542            540
## 4   2013     1     1      544            545
## 5   2013     1     1      554            600
## 6   2013     1     1      554            558
## 7   2013     1     1      555            600
## 8   2013     1     1      557            600
## 9   2013     1     1      557            600
## 10  2013     1     1      558            600
## # ... with 832 more rows, and 14 more variables:
## #   dep_delay &lt;dbl&gt;, arr_time &lt;int&gt;,
## #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
## #   time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="base-r-method" class="section level2">
<h2><span class="header-section-number">3.3</span> <em>Base</em> R method</h2>
<p>This is equivalent to the more verbose code in base R:</p>
<pre class="r"><code>flights[flights$month == 1 &amp; flights$day == 1, ]</code></pre>
<pre><code>## # A tibble: 842 × 19
##     year month   day dep_time sched_dep_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;
## 1   2013     1     1      517            515
## 2   2013     1     1      533            529
## 3   2013     1     1      542            540
## 4   2013     1     1      544            545
## 5   2013     1     1      554            600
## 6   2013     1     1      554            558
## 7   2013     1     1      555            600
## 8   2013     1     1      557            600
## 9   2013     1     1      557            600
## 10  2013     1     1      558            600
## # ... with 832 more rows, and 14 more variables:
## #   dep_delay &lt;dbl&gt;, arr_time &lt;int&gt;,
## #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
## #   time_hour &lt;dttm&gt;</code></pre>
<p>Compare with <code>dplyr</code> method:</p>
<pre class="r"><code>filter(flights, month == 1, day == 1)`</code></pre>
<div class="well">
<p>Filter the <code>flights</code> data set to keep only evening flights (<code>dep_time</code> after 1600) in June.</p>
<button data-toggle="collapse" class="btn btn-primary btn-sm round" data-target="#demo1">
Show Solution
</button>
<div id="demo1" class="collapse">
<pre class="r"><code>filter(flights,dep_time&gt;1600,month==6)</code></pre>
<pre><code>## # A tibble: 10,117 × 19
##     year month   day dep_time sched_dep_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;
## 1   2013     6     1     1602           1505
## 2   2013     6     1     1602           1605
## 3   2013     6     1     1602           1610
## 4   2013     6     1     1603           1610
## 5   2013     6     1     1603           1545
## 6   2013     6     1     1605           1608
## 7   2013     6     1     1605           1600
## 8   2013     6     1     1605           1614
## 9   2013     6     1     1608           1600
## 10  2013     6     1     1609           1615
## # ... with 10,107 more rows, and 14 more
## #   variables: dep_delay &lt;dbl&gt;, arr_time &lt;int&gt;,
## #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
## #   time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
<div id="other-boolean-expressions" class="section level2">
<h2><span class="header-section-number">3.4</span> Other <em>boolean</em> expressions</h2>
<p><code>filter()</code> is similar to <code>subset()</code> except it handles any number of filtering conditions joined together with <code>&amp;</code>.</p>
<p>You can also use other boolean operators, such as <em>OR</em> (“|”):</p>
<pre class="r"><code>filter(flights, month == 1 | month == 2)</code></pre>
<pre><code>## # A tibble: 51,955 × 19
##     year month   day dep_time sched_dep_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;
## 1   2013     1     1      517            515
## 2   2013     1     1      533            529
## 3   2013     1     1      542            540
## 4   2013     1     1      544            545
## 5   2013     1     1      554            600
## 6   2013     1     1      554            558
## 7   2013     1     1      555            600
## 8   2013     1     1      557            600
## 9   2013     1     1      557            600
## 10  2013     1     1      558            600
## # ... with 51,945 more rows, and 14 more
## #   variables: dep_delay &lt;dbl&gt;, arr_time &lt;int&gt;,
## #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
## #   time_hour &lt;dttm&gt;</code></pre>
<div class="well">
<p>Filter the <code>flights</code> data set to keep only ‘redeye’ flights where the departure time (<code>dep_time</code>) is “after” the arrival time (<code>arr_time</code>), indicating it arrived the next day:</p>
<button data-toggle="collapse" class="btn btn-primary btn-sm round" data-target="#demo2">
Show Solution
</button>
<div id="demo2" class="collapse">
<p><br></p>
<pre class="r"><code>filter(flights,dep_time&gt;arr_time)</code></pre>
<pre><code>## # A tibble: 10,633 × 19
##     year month   day dep_time sched_dep_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;
## 1   2013     1     1     1929           1920
## 2   2013     1     1     1939           1840
## 3   2013     1     1     2058           2100
## 4   2013     1     1     2102           2108
## 5   2013     1     1     2108           2057
## 6   2013     1     1     2120           2130
## 7   2013     1     1     2121           2040
## 8   2013     1     1     2128           2135
## 9   2013     1     1     2134           2045
## 10  2013     1     1     2136           2145
## # ... with 10,623 more rows, and 14 more
## #   variables: dep_delay &lt;dbl&gt;, arr_time &lt;int&gt;,
## #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
## #   time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
<div id="select-rows-with-slice" class="section level2">
<h2><span class="header-section-number">3.5</span> Select rows with <code>slice()</code>:</h2>
<pre class="r"><code>slice(flights, 1:10)</code></pre>
<pre><code>## # A tibble: 10 × 19
##     year month   day dep_time sched_dep_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;
## 1   2013     1     1      517            515
## 2   2013     1     1      533            529
## 3   2013     1     1      542            540
## 4   2013     1     1      544            545
## 5   2013     1     1      554            600
## 6   2013     1     1      554            558
## 7   2013     1     1      555            600
## 8   2013     1     1      557            600
## 9   2013     1     1      557            600
## 10  2013     1     1      558            600
## # ... with 14 more variables: dep_delay &lt;dbl&gt;,
## #   arr_time &lt;int&gt;, sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="arrange-rows" class="section level2">
<h2><span class="header-section-number">3.6</span> <code>arrange()</code> rows</h2>
<p><code>arrange()</code> is similar to <code>filter()</code> except it reorders instead of filtering.</p>
<pre class="r"><code>arrange(flights, year, month, day)</code></pre>
<pre><code>## # A tibble: 336,776 × 19
##     year month   day dep_time sched_dep_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;
## 1   2013     1     1      517            515
## 2   2013     1     1      533            529
## 3   2013     1     1      542            540
## 4   2013     1     1      544            545
## 5   2013     1     1      554            600
## 6   2013     1     1      554            558
## 7   2013     1     1      555            600
## 8   2013     1     1      557            600
## 9   2013     1     1      557            600
## 10  2013     1     1      558            600
## # ... with 336,766 more rows, and 14 more
## #   variables: dep_delay &lt;dbl&gt;, arr_time &lt;int&gt;,
## #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
## #   time_hour &lt;dttm&gt;</code></pre>
<p><em>Base</em> R method:</p>
<pre class="r"><code>flights[order(flights$year, flights$month, flights$day), ]</code></pre>
</div>
<div id="descending-order-desc" class="section level2">
<h2><span class="header-section-number">3.7</span> Descending order: <code>desc()</code></h2>
<pre class="r"><code>arrange(flights, desc(arr_delay))</code></pre>
<pre><code>## # A tibble: 336,776 × 19
##     year month   day dep_time sched_dep_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;
## 1   2013     1     9      641            900
## 2   2013     6    15     1432           1935
## 3   2013     1    10     1121           1635
## 4   2013     9    20     1139           1845
## 5   2013     7    22      845           1600
## 6   2013     4    10     1100           1900
## 7   2013     3    17     2321            810
## 8   2013     7    22     2257            759
## 9   2013    12     5      756           1700
## 10  2013     5     3     1133           2055
## # ... with 336,766 more rows, and 14 more
## #   variables: dep_delay &lt;dbl&gt;, arr_time &lt;int&gt;,
## #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
## #   time_hour &lt;dttm&gt;</code></pre>
<p><em>Base</em> R method:</p>
<pre class="r"><code>flights[order(desc(flights$arr_delay)), ]</code></pre>
</div>
<div id="distinct-find-distinct-rows" class="section level2">
<h2><span class="header-section-number">3.8</span> Distinct: Find distinct rows</h2>
<pre class="r"><code>distinct(
  select(flights,carrier)
)</code></pre>
<pre><code>## # A tibble: 16 × 1
##    carrier
##      &lt;chr&gt;
## 1       UA
## 2       AA
## 3       B6
## 4       DL
## 5       EV
## 6       MQ
## 7       US
## 8       WN
## 9       VX
## 10      FL
## 11      AS
## 12      9E
## 13      F9
## 14      HA
## 15      YV
## 16      OO</code></pre>
</div>
<div id="mutate-derive-new-variables" class="section level2">
<h2><span class="header-section-number">3.9</span> Mutate: Derive new variables</h2>
<p>Adds columns with calculations based on other columns.</p>
<p>Average air speed (miles/hour):</p>
<pre class="r"><code>select(
  mutate(flights,ave_speed=distance/(air_time/60)),
  distance, air_time,ave_speed)</code></pre>
<pre><code>## # A tibble: 336,776 × 3
##    distance air_time ave_speed
##       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1      1400      227  370.0441
## 2      1416      227  374.2731
## 3      1089      160  408.3750
## 4      1576      183  516.7213
## 5       762      116  394.1379
## 6       719      150  287.6000
## 7      1065      158  404.4304
## 8       229       53  259.2453
## 9       944      140  404.5714
## 10      733      138  318.6957
## # ... with 336,766 more rows</code></pre>
</div>
<div id="chaining-operations" class="section level2">
<h2><span class="header-section-number">3.10</span> Chaining Operations</h2>
<p>Performing multiple operations sequentially with a <em>pipe</em> character</p>
<ol style="list-style-type: decimal">
<li>Group by a variable</li>
<li>Select some columns</li>
<li>Summarize observations</li>
<li>Filter by results</li>
</ol>
<p>With temporary objects:</p>
<pre class="r"><code>a1 &lt;- group_by(flights, year, month, day)
a2 &lt;- select(a1, arr_delay, dep_delay)</code></pre>
<pre><code>## Adding missing grouping variables: `year`, `month`, `day`</code></pre>
<pre class="r"><code>a3 &lt;- summarise(a2,
                arr = mean(arr_delay, na.rm = TRUE),
                dep = mean(dep_delay, na.rm = TRUE))
a4 &lt;- filter(a3, arr &gt; 30 | dep &gt; 30)
head(a4)</code></pre>
<pre><code>## Source: local data frame [6 x 5]
## Groups: year, month [3]
## 
##    year month   day      arr      dep
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1  2013     1    16 34.24736 24.61287
## 2  2013     1    31 32.60285 28.65836
## 3  2013     2    11 36.29009 39.07360
## 4  2013     2    27 31.25249 37.76327
## 5  2013     3     8 85.86216 83.53692
## 6  2013     3    18 41.29189 30.11796</code></pre>
<p>If you don’t want to save the intermediate results: wrap the function calls inside each other:</p>
<pre class="r"><code>filter(
  summarise(
    select(
      group_by(flights, year, month, day),
      arr_delay, dep_delay
    ),
    arr = mean(arr_delay, na.rm = TRUE),
    dep = mean(dep_delay, na.rm = TRUE)
  ),
  arr &gt; 30 | dep &gt; 30
)</code></pre>
<pre><code>## Adding missing grouping variables: `year`, `month`, `day`</code></pre>
<pre><code>## Source: local data frame [49 x 5]
## Groups: year, month [11]
## 
##     year month   day      arr      dep
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1   2013     1    16 34.24736 24.61287
## 2   2013     1    31 32.60285 28.65836
## 3   2013     2    11 36.29009 39.07360
## 4   2013     2    27 31.25249 37.76327
## 5   2013     3     8 85.86216 83.53692
## 6   2013     3    18 41.29189 30.11796
## 7   2013     4    10 38.41231 33.02368
## 8   2013     4    12 36.04814 34.83843
## 9   2013     4    18 36.02848 34.91536
## 10  2013     4    19 47.91170 46.12783
## # ... with 39 more rows</code></pre>
<p>Arguments are distant from function -&gt; difficult to read!</p>
</div>
<div id="chaining-operations-1" class="section level2">
<h2><span class="header-section-number">3.11</span> Chaining Operations</h2>
<p><code>%&gt;%</code> allows you to <em>pipe</em> together various commands</p>
<p><code>x %&gt;% f(y)</code> turns into <code>f(x, y)</code></p>
<p>So you can use it to rewrite multiple operations that you can read left-to-right, top-to-bottom:</p>
<pre class="r"><code>flights %&gt;%
  group_by(year, month, day) %&gt;%
  select(arr_delay, dep_delay) %&gt;%
  summarise(
    arr = mean(arr_delay, na.rm = TRUE),
    dep = mean(dep_delay, na.rm = TRUE)
  ) %&gt;%
  filter(arr &gt; 30 | dep &gt; 30)</code></pre>
<pre><code>## Adding missing grouping variables: `year`, `month`, `day`</code></pre>
<pre><code>## Source: local data frame [49 x 5]
## Groups: year, month [11]
## 
##     year month   day      arr      dep
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1   2013     1    16 34.24736 24.61287
## 2   2013     1    31 32.60285 28.65836
## 3   2013     2    11 36.29009 39.07360
## 4   2013     2    27 31.25249 37.76327
## 5   2013     3     8 85.86216 83.53692
## 6   2013     3    18 41.29189 30.11796
## 7   2013     4    10 38.41231 33.02368
## 8   2013     4    12 36.04814 34.83843
## 9   2013     4    18 36.02848 34.91536
## 10  2013     4    19 47.91170 46.12783
## # ... with 39 more rows</code></pre>
</div>
<div id="analyze-by-group-with-group_by" class="section level2">
<h2><span class="header-section-number">3.12</span> Analyze by group with <code>group_by()</code></h2>
<p>Perform operations by <em>group</em>: mean departure delay by airport (<code>origin</code>)</p>
<pre class="r"><code>flights %&gt;%
  group_by(origin) %&gt;%
  summarise(meanDelay = mean(dep_delay,na.rm=T))</code></pre>
<pre><code>## # A tibble: 3 × 2
##   origin meanDelay
##    &lt;chr&gt;     &lt;dbl&gt;
## 1    EWR  15.10795
## 2    JFK  12.11216
## 3    LGA  10.34688</code></pre>
<p>Perform operations by <em>group</em>: mean and sd departure delay by airline (<code>carrier</code>)</p>
<pre class="r"><code>flights %&gt;% 
  group_by(carrier) %&gt;%  
  summarise(meanDelay = mean(dep_delay,na.rm=T),
            sdDelay =   sd(dep_delay,na.rm=T))</code></pre>
<pre><code>## # A tibble: 16 × 3
##    carrier meanDelay  sdDelay
##      &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1       9E 16.725769 45.90604
## 2       AA  8.586016 37.35486
## 3       AS  5.804775 31.36303
## 4       B6 13.022522 38.50337
## 5       DL  9.264505 39.73505
## 6       EV 19.955390 46.55235
## 7       F9 20.215543 58.36265
## 8       FL 18.726075 52.66160
## 9       HA  4.900585 74.10990
## 10      MQ 10.552041 39.18457
## 11      OO 12.586207 43.06599
## 12      UA 12.106073 35.71660
## 13      US  3.782418 28.05633
## 14      VX 12.869421 44.81510
## 15      WN 17.711744 43.34435
## 16      YV 18.996330 49.17227</code></pre>
<div class="well">
<p>Flights from which <code>origin</code> airport go the farthest (on average)? Hint: Group by airport (<code>origin</code>) then calculate the maximum flight distance (<code>distance</code>).</p>
<button data-toggle="collapse" class="btn btn-primary btn-sm round" data-target="#demo2a">
Show Solution
</button>
<div id="demo2a" class="collapse">
<pre class="r"><code>flights %&gt;% 
  group_by(origin) %&gt;%  
  summarise(meanDist = mean(distance,na.rm=T))</code></pre>
<pre><code>## # A tibble: 3 × 2
##   origin  meanDist
##    &lt;chr&gt;     &lt;dbl&gt;
## 1    EWR 1056.7428
## 2    JFK 1266.2491
## 3    LGA  779.8357</code></pre>
</div>
</div>
<div class="well">
<p>Which destination airport (<code>dest</code>) is the farthest (<code>distance</code>) from NYC?</p>
<button data-toggle="collapse" class="btn btn-primary btn-sm round" data-target="#demo3">
Show Solution
</button>
<div id="demo3" class="collapse">
<pre class="r"><code>flights %&gt;% 
  arrange(desc(distance)) %&gt;% 
  select(dest,distance) %&gt;% 
  slice(1)</code></pre>
<pre><code>## # A tibble: 1 × 2
##    dest distance
##   &lt;chr&gt;    &lt;dbl&gt;
## 1   HNL     4983</code></pre>
<blockquote>
<p>Which airport is that?</p>
</blockquote>
</div>
</div>
</div>
</div>
<div id="combining-data-sets" class="section level1">
<h1><span class="header-section-number">4</span> Combining data sets</h1>
<div id="dplyr-join-methods" class="section level2">
<h2><span class="header-section-number">4.1</span> <code>dplyr</code> <em>join</em> methods</h2>
<p><img src="02_assets/join1.png" alt="Drawing" style="width: 50%;"/></p>
<ul>
<li><code>left_join(a, b, by = &quot;x1&quot;)</code> Join matching rows from b to a.</li>
<li><code>right_join(a, b, by = &quot;x1&quot;)</code> Join matching rows from a to b.</li>
<li><code>inner_join(a, b, by = &quot;x1&quot;)</code> Retain only rows in both sets.</li>
<li><code>full_join(a, b, by = &quot;x1&quot;)</code> Join data. Retain all values, all rows.</li>
</ul>
<div id="left-join" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Left Join</h3>
<p><code>left_join(a, b, by = &quot;x1&quot;)</code> Join matching rows from b to a.</p>
<p><img src="02_assets/join1.png" alt="Drawing" style="width: 50%;"/> <img src="02_assets/join_left.png" alt="Drawing" style="width: 50%;"/></p>
</div>
<div id="right-join" class="section level3">
<h3><span class="header-section-number">4.1.2</span> Right Join</h3>
<p><code>right_join(a, b, by = &quot;x1&quot;)</code> Join matching rows from a to b.</p>
<p><img src="02_assets/join1.png" alt="Drawing" style="width: 50%;"/> <img src="02_assets/join_right.png" alt="Drawing" style="width: 50%;"/></p>
</div>
<div id="inner-join" class="section level3">
<h3><span class="header-section-number">4.1.3</span> Inner Join</h3>
<p><code>inner_join(a, b, by = &quot;x1&quot;)</code> Retain only rows in both sets.</p>
<p><img src="02_assets/join1.png" alt="Drawing" style="width: 50%;"/> <img src="02_assets/join_inner.png" alt="Drawing" style="width: 50%;"/></p>
</div>
<div id="full-join" class="section level3">
<h3><span class="header-section-number">4.1.4</span> Full Join</h3>
<p><code>full_join(a, b, by = &quot;x1&quot;)</code> Join data. Retain all values, all rows.</p>
<p><img src="02_assets/join1.png" alt="Drawing" style="width: 50%;"/> <img src="02_assets/join_full.png" alt="Drawing" style="width: 50%;"/></p>
<pre class="r"><code>flights%&gt;%
  select(-year,-month,-day,-hour,-minute,-dep_time,-dep_delay)%&gt;%
  glimpse()</code></pre>
<pre><code>## Observations: 336,776
## Variables: 12
## $ sched_dep_time &lt;int&gt; 515, 529, 540, 545, 60...
## $ arr_time       &lt;int&gt; 830, 850, 923, 1004, 8...
## $ sched_arr_time &lt;int&gt; 819, 830, 850, 1022, 8...
## $ arr_delay      &lt;dbl&gt; 11, 20, 33, -18, -25, ...
## $ carrier        &lt;chr&gt; &quot;UA&quot;, &quot;UA&quot;, &quot;AA&quot;, &quot;B6&quot;...
## $ flight         &lt;int&gt; 1545, 1714, 1141, 725,...
## $ tailnum        &lt;chr&gt; &quot;N14228&quot;, &quot;N24211&quot;, &quot;N...
## $ origin         &lt;chr&gt; &quot;EWR&quot;, &quot;LGA&quot;, &quot;JFK&quot;, &quot;...
## $ dest           &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;MIA&quot;, &quot;...
## $ air_time       &lt;dbl&gt; 227, 227, 160, 183, 11...
## $ distance       &lt;dbl&gt; 1400, 1416, 1089, 1576...
## $ time_hour      &lt;dttm&gt; 2013-01-01 05:00:00, ...</code></pre>
<p>Let’s look at the <code>airports</code> data table (<code>?airports</code> for documentation):</p>
<pre class="r"><code>glimpse(airports)</code></pre>
<pre><code>## Observations: 1,396
## Variables: 7
## $ faa  &lt;chr&gt; &quot;04G&quot;, &quot;06A&quot;, &quot;06C&quot;, &quot;06N&quot;, &quot;09J...
## $ name &lt;chr&gt; &quot;Lansdowne Airport&quot;, &quot;Moton Fiel...
## $ lat  &lt;dbl&gt; 41.13047, 32.46057, 41.98934, 41...
## $ lon  &lt;dbl&gt; -80.61958, -85.68003, -88.10124,...
## $ alt  &lt;int&gt; 1044, 264, 801, 523, 11, 1593, 7...
## $ tz   &lt;dbl&gt; -5, -5, -6, -5, -4, -4, -5, -5, ...
## $ dst  &lt;chr&gt; &quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;A...</code></pre>
<div class="well">
<p>What is the name of the destination airport farthest from the NYC airports? Hints:</p>
<ul>
<li>Use a <em>join</em> to connect the <code>flights</code> dataset and <code>airports</code> dataset.</li>
<li>Figure out which column connects the two tables.</li>
<li>You may need to rename the column names before joining.</li>
</ul>
<button data-toggle="collapse" class="btn btn-primary btn-sm round" data-target="#demo4">
Show Solution
</button>
<div id="demo4" class="collapse">
<p><br></p>
<pre class="r"><code>select(airports,
       dest=faa,
       destName=name)%&gt;%
  right_join(flights)%&gt;% 
  arrange(desc(distance)) %&gt;% 
  slice(1) %&gt;% 
  select(destName)</code></pre>
<pre><code>## Joining, by = &quot;dest&quot;</code></pre>
<pre><code>## # A tibble: 1 × 1
##        destName
##           &lt;chr&gt;
## 1 Honolulu Intl</code></pre>
</div>
</div>
</div>
</div>
<div id="plot-the-flights-data" class="section level2">
<h2><span class="header-section-number">4.2</span> Plot the <code>flights</code> data</h2>
<p>The section below shows some ‘advanced’ coding to extract the geographic locations for all flights and plotting. This is just meant as an example to illustrate how one might use these functions to perform a mini-analysis that results in a map.</p>
<div id="join-destination-airports" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Join destination airports</h3>
<pre class="r"><code>library(geosphere)
library(maps)
library(ggplot2)
library(sp)
library(rgeos)</code></pre>
<pre><code>## rgeos version: 0.3-21, (SVN revision 540)
##  GEOS runtime version: 3.4.2-CAPI-1.8.2 r3921 
##  Linking to sp version: 1.2-3 
##  Polygon checking: TRUE</code></pre>
<pre class="r"><code>data=
  select(airports,
         dest=faa,
         destName=name,
         destLat=lat,
         destLon=lon)%&gt;%
  right_join(flights)%&gt;%
  group_by(dest,
           destLon,
           destLat,
           distance)%&gt;%
  summarise(count=n())%&gt;%
  ungroup()%&gt;%
  select(destLon,
         destLat,
         count,
         distance)%&gt;%
  mutate(id=row_number())%&gt;%
  na.omit()</code></pre>
<pre><code>## Joining, by = &quot;dest&quot;</code></pre>
<pre class="r"><code>NYCll=airports%&gt;%filter(faa==&quot;JFK&quot;)%&gt;%select(lon,lat)  # get NYC coordinates

# calculate great circle routes
rts &lt;- gcIntermediate(as.matrix(NYCll),
                      as.matrix(select(data,destLon,destLat)),
                      1000,
                      addStartEnd=TRUE,
                      sp=TRUE)</code></pre>
<pre><code>## NOTE: rgdal::checkCRSArgs: no proj_defs.dat in PROJ.4 shared files</code></pre>
<pre class="r"><code>rts.ff &lt;- fortify(
  as(rts,&quot;SpatialLinesDataFrame&quot;)) # convert into something ggplot can plot

## join with count of flights
rts.ff$id=as.integer(rts.ff$id)
gcircles &lt;- left_join(rts.ff,
                      data,
                      by=&quot;id&quot;) # join attributes, we keep them all, just in case</code></pre>
<p>Now build a basemap using data in the <code>maps</code> package.</p>
<pre class="r"><code>base = ggplot()
worldmap &lt;- map_data(&quot;world&quot;,
                     ylim = c(10, 70),
                     xlim = c(-160, -80))
wrld &lt;- c(geom_polygon(
  aes(long, lat, group = group),
  size = 0.1,
  colour = &quot;grey&quot;,
  fill = &quot;grey&quot;,
  alpha = 1,
  data = worldmap
))</code></pre>
<p>Now draw the map using <code>ggplot</code></p>
<pre class="r"><code>base + wrld +
  geom_path(
    data = gcircles,
    aes(
      long,
      lat,
      col = count,
      group = group,
      order = as.factor(distance)
    ),
    alpha = 0.5,
    lineend = &quot;round&quot;,
    lwd = 1
  ) +
  coord_equal() +
  scale_colour_gradientn(colours = c(&quot;blue&quot;, &quot;orange&quot;, &quot;red&quot;),
                         guide = &quot;colourbar&quot;) +
  theme(panel.background = element_rect(fill = &#39;white&#39;, colour = &#39;white&#39;)) +
  labs(y = &quot;Latitude&quot;, x = &quot;Longitude&quot;,
       title = &quot;Count of Flights from New York in 2013&quot;)</code></pre>
<pre><code>## Warning: Ignoring unknown aesthetics: order</code></pre>
<p><img src="02_DataWrangling_files/figure-html/unnamed-chunk-36-1.png" /><!-- --></p>
</div>
</div>
<div id="colophon" class="section level2">
<h2><span class="header-section-number">4.3</span> Colophon</h2>
<p>This tutorial has been forked from awesome classes developed by Adam Wilson here: <a href="http://adamwilson.us/RDataScience/" class="uri">http://adamwilson.us/RDataScience/</a></p>
<p>This exercise based on code from <a href="http://spatial.ly/2012/06/mapping-worlds-biggest-airlines/">here</a>.</p>
</div>
</div>


<!-- give the footer some space -->
<br/>
<br/>

<footer id="site-footer">
  <div id="footer1">
  <a href="https://cmerow.github.io"><img src="img/cory.png" alt="logo" width=40px></a>
  <!--
  <a href="http://adamwilson.us/#contact"><i class="fa fa-envelope fa-2x"></i></a> 
  <a href="https://twitter.com/AdamWilsonLab"><i class="fa fa-twitter fa-2x"></i></a> 
  <a href="https://github.com/AdamMWilson"><i class="fa fa-github fa-2x"></i></a>
  -->
  </div>
  <div id="footer2">
  <a rel="license" property="http://creativecommons.org/ns#license"
  href="http://creativecommons.org/licenses/by/4.0/" ><img src="img/cc-by.svg" alt="cc-by"/></a> 
  </div>
</footer>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>


</body>
</html>
