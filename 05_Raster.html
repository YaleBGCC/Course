<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>A quick introduction to spatial data analysis</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="cm_yeti_bootswatch.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Ecology, Statistics, and Data Science with R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="Head2_Schedule.html">Schedule</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Course Materials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Head1_CourseContent.html">About Course Content</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Module 1: Introduction to R</li>
    <li>
      <a href="00_CourseIntroductionFrame.html">1.0 Course Introduction</a>
    </li>
    <li>
      <a href="01_Rintro.html">1.1 First Steps</a>
    </li>
    <li>
      <a href="02_DataWrangling.html">1.2 Data Wrangling</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Module 2: Spatial Analysis in R</li>
    <li>
      <a href="05_Raster.html">2.1 Spatial Data</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Module 3: Species Distribution Models</li>
    <li>
      <a href="101SDMs.html">3.1 Basic SDMS</a>
    </li>
    <li>
      <a href="110_SDMs_Integrating_Data_Types.html">3.2 Integrating data types in SDMS</a>
    </li>
    <li class="divider"></li>
  </ul>
</li>
<li>
  <a href="Head3_Resources.html">Resources</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/cmerow/RDataScience/tree/gh-pages">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">A quick introduction to spatial data analysis</h1>

</div>


<div>
<iframe src="05_presentation/05_Spatial.html" width="100%" height="700px">
</iframe>
</div>
<p><a href="05_Raster.R"><i class="fa fa-file-code-o fa-3x" aria-hidden="true"></i> The R Script associated with this page is available here</a>. Download this file and open it (or copy-paste into a new script) with RStudio so you can follow along.</p>
<p>This tutorial has been forked from awesome classes developed by Adam Wilson <a href="http://adamwilson.us/RDataScience/">here</a></p>
<div id="setup" class="section level1">
<h1><span class="header-section-number">1</span> Setup</h1>
<pre class="r"><code>library(dplyr)
library(tidyr)
library(sp)
library(ggplot2)
library(rgeos)
library(maptools)
library(rgdal)
library(raster)
library(rasterVis)  #visualization library for raster
library(sf)</code></pre>
</div>
<div id="point-data" class="section level1">
<h1><span class="header-section-number">2</span> Point data</h1>
<div id="generate-some-random-data" class="section level2">
<h2><span class="header-section-number">2.1</span> Generate some random data</h2>
<pre class="r"><code>coords = data.frame(
  x=rnorm(100),
  y=rnorm(100)
)
str(coords)</code></pre>
<pre><code>## &#39;data.frame&#39;:    100 obs. of  2 variables:
##  $ x: num  1.015 -0.766 -1.031 -1.128 -1.285 ...
##  $ y: num  -0.0538 0.4665 1.6766 1.3182 -0.7389 ...</code></pre>
<pre class="r"><code>plot(coords)</code></pre>
<p><img src="05_Raster_files/figure-html/unnamed-chunk-4-1.png" /><!-- --></p>
</div>
<div id="convert-to-spatialpoints" class="section level2">
<h2><span class="header-section-number">2.2</span> Convert to <code>SpatialPoints</code></h2>
<p>Many tools are designed in R to work specifically with spatial point data, so we need a special object of class <em>SpatialPoints</em>. The important thing is that it has a <em>slot</em> to store coordinates.</p>
<pre class="r"><code>sp = SpatialPoints(coords)
str(sp)</code></pre>
<pre><code>## Formal class &#39;SpatialPoints&#39; [package &quot;sp&quot;] with 3 slots
##   ..@ coords     : num [1:100, 1:2] 1.015 -0.766 -1.031 -1.128 -1.285 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : NULL
##   .. .. ..$ : chr [1:2] &quot;x&quot; &quot;y&quot;
##   ..@ bbox       : num [1:2, 1:2] -3.11 -2.83 2.84 3.11
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr [1:2] &quot;x&quot; &quot;y&quot;
##   .. .. ..$ : chr [1:2] &quot;min&quot; &quot;max&quot;
##   ..@ proj4string:Formal class &#39;CRS&#39; [package &quot;sp&quot;] with 1 slot
##   .. .. ..@ projargs: chr NA</code></pre>
</div>
<div id="create-a-spatialpointsdataframe" class="section level2">
<h2><span class="header-section-number">2.3</span> Create a <code>SpatialPointsDataFrame</code></h2>
<p>First generate a dataframe (analagous to the <em>attribute table</em> in a shapefile)</p>
<pre class="r"><code>data=data.frame(ID=1:100,group=letters[1:20])
head(data)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["ID"],"name":[1],"type":["int"],"align":["right"]},{"label":["group"],"name":[2],"type":["fctr"],"align":["left"]}],"data":[{"1":"1","2":"a","_rn_":"1"},{"1":"2","2":"b","_rn_":"2"},{"1":"3","2":"c","_rn_":"3"},{"1":"4","2":"d","_rn_":"4"},{"1":"5","2":"e","_rn_":"5"},{"1":"6","2":"f","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Combine the coordinates with the data</p>
<pre class="r"><code>spdf = SpatialPointsDataFrame(coords, data)
spdf = SpatialPointsDataFrame(sp, data)

str(spdf)</code></pre>
<pre><code>## Formal class &#39;SpatialPointsDataFrame&#39; [package &quot;sp&quot;] with 5 slots
##   ..@ data       :&#39;data.frame&#39;:  100 obs. of  2 variables:
##   .. ..$ ID   : int [1:100] 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ group: Factor w/ 20 levels &quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   ..@ coords.nrs : num(0) 
##   ..@ coords     : num [1:100, 1:2] 1.015 -0.766 -1.031 -1.128 -1.285 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : NULL
##   .. .. ..$ : chr [1:2] &quot;x&quot; &quot;y&quot;
##   ..@ bbox       : num [1:2, 1:2] -3.11 -2.83 2.84 3.11
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr [1:2] &quot;x&quot; &quot;y&quot;
##   .. .. ..$ : chr [1:2] &quot;min&quot; &quot;max&quot;
##   ..@ proj4string:Formal class &#39;CRS&#39; [package &quot;sp&quot;] with 1 slot
##   .. .. ..@ projargs: chr NA</code></pre>
<p>Note the use of <em>slots</em> designated with a <code>@</code>. See <code>?slot</code> for more.</p>
</div>
<div id="promote-a-data-frame-with-coordinates-to-a-spatialpoints-object" class="section level2">
<h2><span class="header-section-number">2.4</span> Promote a data frame with <code>coordinates()</code> to a <code>SpatialPoints</code> object</h2>
<pre class="r"><code>coordinates(data) = cbind(coords$x, coords$y) </code></pre>
<pre class="r"><code>str(data)</code></pre>
<pre><code>## Formal class &#39;SpatialPointsDataFrame&#39; [package &quot;sp&quot;] with 5 slots
##   ..@ data       :&#39;data.frame&#39;:  100 obs. of  2 variables:
##   .. ..$ ID   : int [1:100] 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ group: Factor w/ 20 levels &quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   ..@ coords.nrs : num(0) 
##   ..@ coords     : num [1:100, 1:2] 1.015 -0.766 -1.031 -1.128 -1.285 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : NULL
<<<<<<< HEAD
##   .. .. ..$ : chr [1:2] &quot;x&quot; &quot;y&quot;
##   ..@ bbox       : num [1:2, 1:2] -3.11 -2.83 2.84 3.11
=======
##   .. .. ..$ : chr [1:2] &quot;coords.x1&quot; &quot;coords.x2&quot;
##   ..@ bbox       : num [1:2, 1:2] -2.29 -1.83 2.37 2.35
>>>>>>> 4f7979a4348b8de3b65c3af72c0aa4ff665e4020
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr [1:2] &quot;coords.x1&quot; &quot;coords.x2&quot;
##   .. .. ..$ : chr [1:2] &quot;min&quot; &quot;max&quot;
##   ..@ proj4string:Formal class &#39;CRS&#39; [package &quot;sp&quot;] with 1 slot
##   .. .. ..@ projargs: chr NA</code></pre>
</div>
<div id="subset-data" class="section level2">
<h2><span class="header-section-number">2.5</span> Subset data</h2>
<pre class="r"><code>subset(spdf, group==&quot;a&quot;)</code></pre>
<pre><code>## class       : SpatialPointsDataFrame 
## features    : 5 
## extent      : -1.108746, 2.843913, -1.01525, 1.008464  (xmin, xmax, ymin, ymax)
## coord. ref. : NA 
## variables   : 2
## names       : ID, group 
## min values  :  1,     a 
## max values  : 81,     a</code></pre>
<p>Or using <code>[]</code></p>
<pre class="r"><code>spdf[spdf$group==&quot;a&quot;,]</code></pre>
<pre><code>## class       : SpatialPointsDataFrame 
## features    : 5 
## extent      : -1.108746, 2.843913, -1.01525, 1.008464  (xmin, xmax, ymin, ymax)
## coord. ref. : NA 
## variables   : 2
## names       : ID, group 
## min values  :  1,     a 
## max values  : 81,     a</code></pre>
<!-- Unfortunately, `dplyr` functions do not directly filter spatial objects. -->
<div class="well">
<h2 id="your-turn"><span class="header-section-number">2.5</span> Your turn</h2>
<p>Convert the following <code>data.frame</code> into a SpatialPointsDataFrame using the <code>coordinates()</code> method and then plot the points with <code>plot()</code>.</p>
<pre class="r"><code>df=data.frame(
  lat=c(12,15,17,12),
  lon=c(-35,-35,-32,-32),
  id=c(1,2,3,4))</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">lat</th>
<th align="right">lon</th>
<th align="right">id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">12</td>
<td align="right">-35</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">15</td>
<td align="right">-35</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">17</td>
<td align="right">-32</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">12</td>
<td align="right">-32</td>
<td align="right">4</td>
</tr>
</tbody>
</table>
<button data-toggle="collapse" class="btn btn-primary btn-sm round" data-target="#demo1">
Show Solution
</button>
<div id="demo1" class="collapse">
<pre class="r"><code>coordinates(df)=c(&quot;lon&quot;,&quot;lat&quot;)
plot(df)</code></pre>
<p><img src="05_Raster_files/figure-html/unnamed-chunk-14-1.png" /><!-- --></p>
</div>
</div>
</div>
<div id="examine-topsoil-quality-in-the-meuse-river-data-set" class="section level2">
<h2><span class="header-section-number">2.6</span> Examine topsoil quality in the Meuse river data set</h2>
<pre class="r"><code>## Load the data
data(meuse)
str(meuse)</code></pre>
<pre><code>## &#39;data.frame&#39;:    155 obs. of  14 variables:
##  $ x      : num  181072 181025 181165 181298 181307 ...
##  $ y      : num  333611 333558 333537 333484 333330 ...
##  $ cadmium: num  11.7 8.6 6.5 2.6 2.8 3 3.2 2.8 2.4 1.6 ...
##  $ copper : num  85 81 68 81 48 61 31 29 37 24 ...
##  $ lead   : num  299 277 199 116 117 137 132 150 133 80 ...
##  $ zinc   : num  1022 1141 640 257 269 ...
##  $ elev   : num  7.91 6.98 7.8 7.66 7.48 ...
##  $ dist   : num  0.00136 0.01222 0.10303 0.19009 0.27709 ...
##  $ om     : num  13.6 14 13 8 8.7 7.8 9.2 9.5 10.6 6.3 ...
##  $ ffreq  : Factor w/ 3 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ soil   : Factor w/ 3 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;: 1 1 1 2 2 2 2 1 1 2 ...
##  $ lime   : Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 2 2 2 1 1 1 1 1 1 1 ...
##  $ landuse: Factor w/ 15 levels &quot;Aa&quot;,&quot;Ab&quot;,&quot;Ag&quot;,..: 4 4 4 11 4 11 4 2 2 15 ...
##  $ dist.m : num  50 30 150 270 380 470 240 120 240 420 ...</code></pre>
<div class="well">
<h2 id="your-turn-1"><span class="header-section-number">2.6</span> Your turn</h2>
<p><em>Promote</em> the <code>meuse</code> object to a spatial points data.frame with <code>coordinates()</code>.</p>
<button data-toggle="collapse" class="btn btn-primary btn-sm round" data-target="#demo2">
Show Solution
</button>
<div id="demo2" class="collapse">
<pre class="r"><code>coordinates(meuse) &lt;- ~x+y
# OR   coordinates(meuse)=cbind(meuse$x,meuse$y)
# OR   coordinates(meuse))=c(&quot;x&quot;,&quot;y&quot;)
str(meuse)</code></pre>
<pre><code>## Formal class &#39;SpatialPointsDataFrame&#39; [package &quot;sp&quot;] with 5 slots
##   ..@ data       :&#39;data.frame&#39;:  155 obs. of  12 variables:
##   .. ..$ cadmium: num [1:155] 11.7 8.6 6.5 2.6 2.8 3 3.2 2.8 2.4 1.6 ...
##   .. ..$ copper : num [1:155] 85 81 68 81 48 61 31 29 37 24 ...
##   .. ..$ lead   : num [1:155] 299 277 199 116 117 137 132 150 133 80 ...
##   .. ..$ zinc   : num [1:155] 1022 1141 640 257 269 ...
##   .. ..$ elev   : num [1:155] 7.91 6.98 7.8 7.66 7.48 ...
##   .. ..$ dist   : num [1:155] 0.00136 0.01222 0.10303 0.19009 0.27709 ...
##   .. ..$ om     : num [1:155] 13.6 14 13 8 8.7 7.8 9.2 9.5 10.6 6.3 ...
##   .. ..$ ffreq  : Factor w/ 3 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ soil   : Factor w/ 3 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;: 1 1 1 2 2 2 2 1 1 2 ...
##   .. ..$ lime   : Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 2 2 2 1 1 1 1 1 1 1 ...
##   .. ..$ landuse: Factor w/ 15 levels &quot;Aa&quot;,&quot;Ab&quot;,&quot;Ag&quot;,..: 4 4 4 11 4 11 4 2 2 15 ...
##   .. ..$ dist.m : num [1:155] 50 30 150 270 380 470 240 120 240 420 ...
##   ..@ coords.nrs : int [1:2] 1 2
##   ..@ coords     : num [1:155, 1:2] 181072 181025 181165 181298 181307 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr [1:155] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##   .. .. ..$ : chr [1:2] &quot;x&quot; &quot;y&quot;
##   ..@ bbox       : num [1:2, 1:2] 178605 329714 181390 333611
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr [1:2] &quot;x&quot; &quot;y&quot;
##   .. .. ..$ : chr [1:2] &quot;min&quot; &quot;max&quot;
##   ..@ proj4string:Formal class &#39;CRS&#39; [package &quot;sp&quot;] with 1 slot
##   .. .. ..@ projargs: chr NA</code></pre>
</div>
</div>
<p>Plot it with ggplot:</p>
<pre class="r"><code>  ggplot(as.data.frame(meuse),aes(x=x,y=y))+
    geom_point(col=&quot;red&quot;)+
    coord_equal()</code></pre>
<p><img src="05_Raster_files/figure-html/unnamed-chunk-17-1.png" /><!-- --></p>
<p>Note that <code>ggplot</code> works only with data.frames. Convert with <code>as.data.frame()</code> or <code>fortify()</code>.</p>
</div>
<div id="ggplot" class="section level2">
<h2><span class="header-section-number">2.7</span> ggplot</h2>
<p>If you’re not familiar with ggplot, here’s a quick digression. For a more detailed version, see the ggplot section in Lesson 03: Plotting. # <a href="http://ggplot2.org"><code>ggplot2</code></a> The <em>grammar of graphics</em> consists of specifying a number of key elements of a plot. These are the same elements you’d put in any base graphics plot; this approach just provides a consisent way of defining them</p>
<ol style="list-style-type: decimal">
<li>Data: The raw data</li>
<li><code>geom_</code>: The geometric shapes representing data (e.g. use a circle or triangle)</li>
<li><code>aes()</code>: Aesthetics of the geometric and statistical objects (color, size, shape, and position)</li>
<li><code>scale_</code>: Maps between the data and the aesthetic dimensions (e.g. x- and y-limits)</li>
</ol>
<pre><code>data
+ geometry,
+ aesthetic mappings like position, color and size
+ scaling of ranges of the data to ranges of the aesthetics</code></pre>
<p>Additional settings</p>
<ol start="5" style="list-style-type: decimal">
<li><code>stat_</code>: Statistical summaries of the data that can be plotted, such as quantiles, fitted curves (loess, linear models), etc.</li>
<li><code>coord_</code>: Transformation for mapping data coordinates into the plane of the data rectangle</li>
<li><code>facet_</code>: Arrangement of data into grid of plots (e.g. a grid with one plot for each species, location, or time)</li>
<li><code>theme</code>: Visual defaults (background, grids, axes, typeface, colors, etc.)</li>
</ol>
<pre class="r"><code># Old Faithful Geyser Data on duration and waiting times.
library(&quot;MASS&quot;)</code></pre>
<pre><code>## 
## Attaching package: &#39;MASS&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:raster&#39;:
## 
##     area, select</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     select</code></pre>
<pre class="r"><code>data(geyser)
m &lt;- ggplot(geyser, aes(x = duration, y = waiting)) # define data
m + # reference the data
  geom_point() +  # add points
  stat_density2d(geom=&quot;contour&quot;) + # add a contour plot
  xlim(0.5, 6) + ylim(40, 110) # define plot limits</code></pre>
<p><img src="05_Raster_files/figure-html/unnamed-chunk-18-1.png" /><!-- --></p>
<p>And now back to spatial data …</p>
</div>
</div>
<div id="raster-package" class="section level1">
<h1><span class="header-section-number">3</span> Raster Package</h1>
<div id="getdata" class="section level2">
<h2><span class="header-section-number">3.1</span> <code>getData()</code></h2>
<p>Raster package includes access to some useful (vector and raster) datasets with <code>getData()</code>:</p>
<ul>
<li>Elevation (SRTM 90m resolution raster)</li>
<li>World Climate (Tmin, Tmax, Precip, BioClim rasters)</li>
<li>Countries from CIA factsheet (vector!)</li>
<li>Global Administrative boundaries (vector!)</li>
</ul>
<p><code>getData()</code> steps for GADM:</p>
<ol style="list-style-type: decimal">
<li><em>Select Dataset</em>: ‘GADM’ returns the global administrative boundaries.</li>
<li><em>Select country</em>: Country name of the boundaries using its ISO A3 country code</li>
<li><em>Specify level</em>: Level of of administrative subdivision (0=country, 1=first level subdivision).</li>
</ol>
</div>
<div id="shapefiles-global-administrative-areas" class="section level2">
<h2><span class="header-section-number">3.2</span> Shapefiles: Global Administrative Areas</h2>
<p>Administrative areas in this database are countries and lower level subdivisions.</p>
<p><img src="05_assets/gadm25.png" alt="alt text" width="70%"></p>
<p>Divided by country (see website for full dataset). Explore country list:</p>
<pre class="r"><code>getData(&quot;ISO3&quot;)%&gt;%
  as.data.frame%&gt;%
  filter(NAME==&quot;South Africa&quot;)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["ISO3"],"name":[1],"type":["chr"],"align":["left"]},{"label":["NAME"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"ZAF","2":"South Africa"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<blockquote>
<p>Note that <code>%&gt;%</code> is a <em>pipe</em>, defined by the <code>dplyr</code> package that says ’Use the previous thing as the first argument in this function. So this is equivalent to <code>temp1 = getData(&quot;ISO3&quot;)</code> followed by <code>temp2 = as.data.frame(temp1)</code> followed by <code>output=filter(temp2,NAME==South Africa')</code>.</p>
</blockquote>
<p>Download data for South Africa</p>
<pre class="r"><code>za=getData(&#39;GADM&#39;, country=&#39;ZAF&#39;, level=1)</code></pre>
<pre class="r"><code>plot(za) # this can be a little slow</code></pre>
<p><img src="05_assets/za_vector.png" alt="alt text" width="70%"></p>
<p>Danger: <code>plot()</code> works, but can be slow for complex polygons.</p>
<div id="check-out-attribute-table" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Check out attribute table</h3>
<pre class="r"><code>za@data</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["OBJECTID"],"name":[1],"type":["int"],"align":["right"]},{"label":["ID_0"],"name":[2],"type":["int"],"align":["right"]},{"label":["ISO"],"name":[3],"type":["chr"],"align":["left"]},{"label":["NAME_0"],"name":[4],"type":["chr"],"align":["left"]},{"label":["ID_1"],"name":[5],"type":["int"],"align":["right"]},{"label":["NAME_1"],"name":[6],"type":["chr"],"align":["left"]},{"label":["HASC_1"],"name":[7],"type":["chr"],"align":["left"]},{"label":["CCN_1"],"name":[8],"type":["int"],"align":["right"]},{"label":["CCA_1"],"name":[9],"type":["chr"],"align":["left"]},{"label":["TYPE_1"],"name":[10],"type":["chr"],"align":["left"]},{"label":["ENGTYPE_1"],"name":[11],"type":["chr"],"align":["left"]},{"label":["NL_NAME_1"],"name":[12],"type":["chr"],"align":["left"]},{"label":["VARNAME_1"],"name":[13],"type":["chr"],"align":["left"]}],"data":[{"1":"1","2":"211","3":"ZAF","4":"South Africa","5":"1","6":"Eastern Cape","7":"ZA.EC","8":"NA","9":"EC","10":"Provinsie","11":"Province","12":"","13":"Oos-Kaap"},{"1":"2","2":"211","3":"ZAF","4":"South Africa","5":"2","6":"Free State","7":"ZA.FS","8":"NA","9":"FS","10":"Provinsie","11":"Province","12":"","13":"Orange Free State|Vrystaat"},{"1":"3","2":"211","3":"ZAF","4":"South Africa","5":"3","6":"Gauteng","7":"ZA.GT","8":"NA","9":"GT","10":"Provinsie","11":"Province","12":"","13":"Pretoria/Witwatersrand/Vaal"},{"1":"4","2":"211","3":"ZAF","4":"South Africa","5":"4","6":"KwaZulu-Natal","7":"ZA.NL","8":"NA","9":"KZN","10":"Provinsie","11":"Province","12":"","13":"Natal and Zululand"},{"1":"5","2":"211","3":"ZAF","4":"South Africa","5":"5","6":"Limpopo","7":"ZA.NP","8":"NA","9":"LIM","10":"Provinsie","11":"Province","12":"","13":"Noordelike Provinsie|Northern Transvaal|Northern Province"},{"1":"6","2":"211","3":"ZAF","4":"South Africa","5":"6","6":"Mpumalanga","7":"ZA.MP","8":"NA","9":"MP","10":"Provinsie","11":"Province","12":"","13":"Eastern Transvaal"},{"1":"7","2":"211","3":"ZAF","4":"South Africa","5":"7","6":"North West","7":"ZA.NW","8":"NA","9":"NW","10":"Provinsie","11":"Province","12":"","13":"North-West|Noordwes"},{"1":"8","2":"211","3":"ZAF","4":"South Africa","5":"8","6":"Northern Cape","7":"ZA.NC","8":"NA","9":"NC","10":"Provinsie","11":"Province","12":"","13":"Noord-Kaap"},{"1":"9","2":"211","3":"ZAF","4":"South Africa","5":"9","6":"Western Cape","7":"ZA.WC","8":"NA","9":"WC","10":"Provinsie","11":"Province","12":"","13":"Wes-Kaap"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>za=subset(za,NAME_1==&quot;Eastern Cape&quot;)
plot(za)</code></pre>
<div class="well">
<h2 id="your-turn-2"><span class="header-section-number">3.2.1</span> Your turn</h2>
<p>Use the method above to download and plot the boundaries for a country of your choice.</p>
<button data-toggle="collapse" class="btn btn-primary btn-sm round" data-target="#demo1">
Show Solution
</button>
<div id="demo1" class="collapse">
<pre class="r"><code>getData(&quot;ISO3&quot;)%&gt;%
  as.data.frame%&gt;%
  filter(NAME==&quot;Tunisia&quot;)

country=getData(&#39;GADM&#39;, country=&#39;TUN&#39;, level=1)
plot(country)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="raster-data" class="section level1">
<h1><span class="header-section-number">4</span> Raster Data</h1>
<div id="raster-introduction" class="section level2">
<h2><span class="header-section-number">4.1</span> Raster introduction</h2>
<p>Spatial data structure dividing region (‘grid’) into rectangles (’cells’ or ’pixels’) storing one or more values each.</p>
<p><small> Some examples from the <a href="http://cran.r-project.org/web/packages/raster/vignettes/Raster.pdf">Raster vignette</a> by Robert J. Hijmans. </small></p>
<ul>
<li><code>rasterLayer</code>: 1 band</li>
<li><code>rasterStack</code>: Multiple Bands</li>
<li><code>rasterBrick</code>: Multiple Bands of <em>same</em> thing.</li>
</ul>
<p>Normally, you’ll obtain rasters data by downloading it from somewhere (e.g. global climate data below), but to get a better understanding of rasters, let’s build one from scratch.</p>
<pre class="r"><code>x &lt;- raster()
x</code></pre>
<pre><code>## class       : RasterLayer 
## dimensions  : 180, 360, 64800  (nrow, ncol, ncell)
## resolution  : 1, 1  (x, y)
## extent      : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0</code></pre>
<p>There are lots of slots to handle all the ways one might need to use a raster; fortunately you won’t have to dig into the majority of these.</p>
<pre class="r"><code>str(x)</code></pre>
<pre><code>## Formal class &#39;RasterLayer&#39; [package &quot;raster&quot;] with 12 slots
##   ..@ file    :Formal class &#39;.RasterFile&#39; [package &quot;raster&quot;] with 13 slots
##   .. .. ..@ name        : chr &quot;&quot;
##   .. .. ..@ datanotation: chr &quot;FLT4S&quot;
##   .. .. ..@ byteorder   : chr &quot;little&quot;
##   .. .. ..@ nodatavalue : num -Inf
##   .. .. ..@ NAchanged   : logi FALSE
##   .. .. ..@ nbands      : int 1
##   .. .. ..@ bandorder   : chr &quot;BIL&quot;
##   .. .. ..@ offset      : int 0
##   .. .. ..@ toptobottom : logi TRUE
##   .. .. ..@ blockrows   : int 0
##   .. .. ..@ blockcols   : int 0
##   .. .. ..@ driver      : chr &quot;&quot;
##   .. .. ..@ open        : logi FALSE
##   ..@ data    :Formal class &#39;.SingleLayerData&#39; [package &quot;raster&quot;] with 13 slots
##   .. .. ..@ values    : logi(0) 
##   .. .. ..@ offset    : num 0
##   .. .. ..@ gain      : num 1
##   .. .. ..@ inmemory  : logi FALSE
##   .. .. ..@ fromdisk  : logi FALSE
##   .. .. ..@ isfactor  : logi FALSE
##   .. .. ..@ attributes: list()
##   .. .. ..@ haveminmax: logi FALSE
##   .. .. ..@ min       : num Inf
##   .. .. ..@ max       : num -Inf
##   .. .. ..@ band      : int 1
##   .. .. ..@ unit      : chr &quot;&quot;
##   .. .. ..@ names     : chr &quot;&quot;
##   ..@ legend  :Formal class &#39;.RasterLegend&#39; [package &quot;raster&quot;] with 5 slots
##   .. .. ..@ type      : chr(0) 
##   .. .. ..@ values    : logi(0) 
##   .. .. ..@ color     : logi(0) 
##   .. .. ..@ names     : logi(0) 
##   .. .. ..@ colortable: logi(0) 
##   ..@ title   : chr(0) 
##   ..@ extent  :Formal class &#39;Extent&#39; [package &quot;raster&quot;] with 4 slots
##   .. .. ..@ xmin: num -180
##   .. .. ..@ xmax: num 180
##   .. .. ..@ ymin: num -90
##   .. .. ..@ ymax: num 90
##   ..@ rotated : logi FALSE
##   ..@ rotation:Formal class &#39;.Rotation&#39; [package &quot;raster&quot;] with 2 slots
##   .. .. ..@ geotrans: num(0) 
##   .. .. ..@ transfun:function ()  
##   ..@ ncols   : int 360
##   ..@ nrows   : int 180
##   ..@ crs     :Formal class &#39;CRS&#39; [package &quot;sp&quot;] with 1 slot
##   .. .. ..@ projargs: chr &quot;+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0&quot;
##   ..@ history : list()
##   ..@ z       : list()</code></pre>
<p>The most useful functions for accessing slots are <code>values()</code> to get data values, <code>extent()</code> to get the bounding box, <code>crs()</code> to get the projection.</p>
<pre class="r"><code>x &lt;- raster(ncol=36, nrow=18, xmn=-1000, xmx=1000, ymn=-100, ymx=900)
res(x)</code></pre>
<pre><code>## [1] 55.55556 55.55556</code></pre>
<pre class="r"><code>ncol(x)</code></pre>
<pre><code>## [1] 36</code></pre>
<pre class="r"><code>extent(x)</code></pre>
<pre><code>## class       : Extent 
## xmin        : -1000 
## xmax        : 1000 
## ymin        : -100 
## ymax        : 900</code></pre>
<pre class="r"><code>head(values(x))</code></pre>
<pre><code>## [1] NA NA NA NA NA NA</code></pre>
<!-- ```{r} -->
<!-- # change the numer of columns (affects resolution) -->
<!-- ncol(x) <- 18 -->
<!-- ncol(x) -->
<!-- res(x) -->
<!-- ``` -->
</div>
<div id="raster-data-storage" class="section level2">
<h2><span class="header-section-number">4.2</span> Raster data storage</h2>
<pre class="r"><code>r &lt;- raster(ncol=10, nrow=10)
ncell(r)</code></pre>
<pre><code>## [1] 100</code></pre>
<p>But it is an empty raster</p>
<pre class="r"><code>hasValues(r)</code></pre>
<pre><code>## [1] FALSE</code></pre>
<p>Use <code>values()</code> function:</p>
<pre class="r"><code>values(r) &lt;- 1:ncell(r)
hasValues(r)</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="r"><code>values(r)[1:10]</code></pre>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<div class="well">
<h2 id="your-turn-3"><span class="header-section-number">4.2</span> Your turn</h2>
<p>Create and then plot a new raster with:</p>
<ol style="list-style-type: decimal">
<li>100 rows</li>
<li>50 columns</li>
<li>Fill it with random values (<code>rnorm()</code>)</li>
</ol>
<button data-toggle="collapse" class="btn btn-primary btn-sm round" data-target="#demo2">
Show Solution
</button>
<div id="demo2" class="collapse">
<pre class="r"><code>x=raster(nrow=100,ncol=50,vals=rnorm(100*50))
# OR
x= raster(nrow=100,ncol=50)
values(x)= rnorm(5000)

plot(x)</code></pre>
<p><img src="05_Raster_files/figure-html/unnamed-chunk-32-1.png" /><!-- --></p>
</div>
</div>
<!-- ## Raster memory usage -->
<!-- Raster data files can be very large, especially when cells are at high resolution, so it becomes important to think about how much RAM is required to work with a raster to avoid slowing your computer to a crawl. The `raster` package cleverly avoids reading full rasters into memory to instead just provides pointers to the relevant raster files. -->
<!-- ```{r} -->
<!-- inMemory(r) -->
<!-- ``` -->
<!-- > You can change the memory options using the `maxmemory` option in `rasterOptions()`  -->
</div>
<div id="raster-plotting" class="section level2">
<h2><span class="header-section-number">4.3</span> Raster Plotting</h2>
<p>Plotting is easy (but slow) with <code>plot</code>.</p>
<pre class="r"><code>plot(r, main=&#39;Raster with 100 cells&#39;)</code></pre>
<<<<<<< HEAD
<p><img src="05_Raster_files/figure-html/unnamed-chunk-34-1.png" /><!-- --></p>
=======
<p><img src="05_Raster_files/figure-html/unnamed-chunk-33-1.png" /><!-- --></p>
>>>>>>> 4f7979a4348b8de3b65c3af72c0aa4ff665e4020
<div id="ggplot-and-rastervis" class="section level3">
<h3><span class="header-section-number">4.3.1</span> ggplot and rasterVis</h3>
<p>rasterVis package has <code>gplot()</code> for plotting raster data in the <code>ggplot()</code> framework.</p>
<pre class="r"><code>gplot(r,maxpixels=50000)+ # reference the data
  geom_raster(aes(fill=value)) # cell&#39;s data value determines its color</code></pre>
<<<<<<< HEAD
<p><img src="05_Raster_files/figure-html/unnamed-chunk-35-1.png" /><!-- --></p>
<p>Adjust <code>maxpixels</code> for faster plotting of large datasets.</p>
<pre class="r"><code>gplot(r,maxpixels=10)+
  geom_raster(aes(fill=value))</code></pre>
<p><img src="05_Raster_files/figure-html/unnamed-chunk-36-1.png" /><!-- --></p>
=======
<p><img src="05_Raster_files/figure-html/unnamed-chunk-34-1.png" /><!-- --></p>
<p>Adjust <code>maxpixels</code> for faster plotting of large datasets.</p>
<pre class="r"><code>gplot(r,maxpixels=10)+
  geom_raster(aes(fill=value))</code></pre>
<p><img src="05_Raster_files/figure-html/unnamed-chunk-35-1.png" /><!-- --></p>
>>>>>>> 4f7979a4348b8de3b65c3af72c0aa4ff665e4020
<!-- Can use all the `ggplot` color ramps, etc. -->
<!-- ```{r} -->
<!-- gplot(r)+ # reference the data -->
<!--   geom_raster(aes(fill=value))+ # cell's data value determines its color -->
<!--   scale_fill_distiller(palette="OrRd") # specify the color pallette -->
<!-- ``` -->
</div>
</div>
<div id="spatial-projections" class="section level2">
<h2><span class="header-section-number">4.4</span> Spatial Projections</h2>
<p>Raster package uses standard <a href="http://www.spatialreference.org">coordinate reference system (CRS)</a>.</p>
<p>For example, see the projection format for the <a href="http://www.spatialreference.org/ref/epsg/4326/"><em>standard</em> WGS84</a>.</p>
<pre class="r"><code>projection(r)</code></pre>
<pre><code>## [1] &quot;+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0&quot;</code></pre>
</div>
<div id="useful-functions" class="section level2">
<h2><span class="header-section-number">4.5</span> Useful functions</h2>
<p>The following are some of the more useful functions in the raster package when building species’ range models (as we’ll be doing next time.) I list them here so you can get an idea of the types of common spatial operations. Try running the examples in their help files; raster’s help files are very well done.</p>
<ul>
<li><code>projectRaster</code> - switch between projections. E.g., sometimes you’ll download data from different sources that use differnt projections. Equal area projections are often useful.</li>
<li><code>aggregate</code> - make a coarser resolution raster. E.g., explore scale dependence.</li>
<li><code>resample</code> - transfer values between non-matching rasters. e.g., the cells are different sizes.</li>
<li><code>crop</code> - change the extent of a raster, e.g., to get two rasters to line up with one another.</li>
<li><code>rasterize</code> - turn another type of spatial object (points, polygons) into a raster</li>
</ul>
</div>
</div>
<div id="worldclim" class="section level1">
<h1><span class="header-section-number">5</span> WorldClim</h1>
<div id="overview-of-worldclim" class="section level2">
<h2><span class="header-section-number">5.1</span> Overview of WorldClim</h2>
<p>Mean monthly climate and derived variables interpolated from weather stations on a 30 arc-second (~1km) grid. See <a href="http://www.worldclim.org/methods">worldclim.org</a></p>
</div>
<div id="bioclim-variables" class="section level2">
<h2><span class="header-section-number">5.2</span> Bioclim variables</h2>
<p><small></p>
<table>
<thead>
<tr class="header">
<th>Varia</th>
<th>ble Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BIO1</td>
<td>Annual Mean Temperature</td>
</tr>
<tr class="even">
<td>BIO2</td>
<td>Mean Diurnal Range (Mean of monthly (max temp – min temp))</td>
</tr>
<tr class="odd">
<td>BIO3</td>
<td>Isothermality (BIO2/BIO7) (* 100)</td>
</tr>
<tr class="even">
<td>BIO4</td>
<td>Temperature Seasonality (standard deviation *100)</td>
</tr>
<tr class="odd">
<td>BIO5</td>
<td>Max Temperature of Warmest Month</td>
</tr>
<tr class="even">
<td>BIO6</td>
<td>Min Temperature of Coldest Month</td>
</tr>
<tr class="odd">
<td>BIO7</td>
<td>Temperature Annual Range (BIO5-BIO6)</td>
</tr>
<tr class="even">
<td>BIO8</td>
<td>Mean Temperature of Wettest Quarter</td>
</tr>
<tr class="odd">
<td>BIO9</td>
<td>Mean Temperature of Driest Quarter</td>
</tr>
<tr class="even">
<td>BIO10</td>
<td>Mean Temperature of Warmest Quarter</td>
</tr>
<tr class="odd">
<td>BIO11</td>
<td>Mean Temperature of Coldest Quarter</td>
</tr>
<tr class="even">
<td>BIO12</td>
<td>Annual Precipitation</td>
</tr>
<tr class="odd">
<td>BIO13</td>
<td>Precipitation of Wettest Month</td>
</tr>
<tr class="even">
<td>BIO14</td>
<td>Precipitation of Driest Month</td>
</tr>
<tr class="odd">
<td>BIO15</td>
<td>Precipitation Seasonality (Coefficient of Variation)</td>
</tr>
<tr class="even">
<td>BIO16</td>
<td>Precipitation of Wettest Quarter</td>
</tr>
<tr class="odd">
<td>BIO17</td>
<td>Precipitation of Driest Quarter</td>
</tr>
<tr class="even">
<td>BIO18</td>
<td>Precipitation of Warmest Quarter</td>
</tr>
<tr class="odd">
<td>BIO19</td>
<td>Precipitation of Coldest Quarter</td>
</tr>
</tbody>
</table>
<p></small></p>
</div>
<div id="download-climate-data" class="section level2">
<h2><span class="header-section-number">5.3</span> Download climate data</h2>
<p>Download the data:</p>
<pre class="r"><code>clim=getData(&#39;worldclim&#39;, var=&#39;bio&#39;, res=10) </code></pre>
<p><code>res</code> is resolution (0.5, 2.5, 5, and 10 minutes of a degree)</p>
<div id="gain-and-offset" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Gain and Offset</h3>
<pre class="r"><code>clim</code></pre>
<pre><code>## class       : RasterStack 
## dimensions  : 900, 2160, 1944000, 19  (nrow, ncol, ncell, nlayers)
## resolution  : 0.1666667, 0.1666667  (x, y)
## extent      : -180, 180, -60, 90  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
## names       :  bio1,  bio2,  bio3,  bio4,  bio5,  bio6,  bio7,  bio8,  bio9, bio10, bio11, bio12, bio13, bio14, bio15, ... 
## min values  :  -269,     9,     8,    72,   -59,  -547,    53,  -251,  -450,   -97,  -488,     0,     0,     0,     0, ... 
## max values  :   314,   211,    95, 22673,   489,   258,   725,   375,   364,   380,   289,  9916,  2088,   652,   261, ...</code></pre>
<p>Note the min/max of the raster. What are the units? Always check metadata, the <a href="http://www.worldclim.org/formats">WorldClim temperature dataset</a> has a <code>gain</code> of 0.1, meaning that it must be multipled by 0.1 to convert back to degrees Celsius. Precipitation is in mm, so a gain of 0.1 would turn that into cm.</p>
<pre class="r"><code>gain(clim)=0.1</code></pre>
</div>
<div id="plot-with-plot" class="section level3">
<h3><span class="header-section-number">5.3.2</span> Plot with <code>plot()</code></h3>
<pre class="r"><code>plot(clim[[1:3]]) # just the first 3, since its slow</code></pre>
<p><img src="05_Raster_files/figure-html/unnamed-chunk-40-1.png" /><!-- --></p>
</div>
</div>
<div id="faceting-in-ggplot" class="section level2">
<h2><span class="header-section-number">5.4</span> Faceting in ggplot</h2>
<p>Or use <code>rasterVis</code> methods with gplot</p>
<pre class="r"><code>gplot(clim[[1:3]])+geom_raster(aes(fill=value))+
  facet_wrap(~variable)+
  scale_fill_gradientn(colours=c(&quot;brown&quot;,&quot;red&quot;,&quot;yellow&quot;,&quot;darkgreen&quot;,&quot;green&quot;),trans=&quot;log10&quot;)+
  coord_equal()</code></pre>
<pre><code>## Warning in self$trans$transform(x): NaNs produced</code></pre>
<pre><code>## Warning: Transformation introduced infinite values in discrete y-axis</code></pre>
<p><img src="05_Raster_files/figure-html/unnamed-chunk-41-1.png" /><!-- --></p>
<p>Let’s dig a little deeper into the data object:</p>
<pre class="r"><code>## is it held in RAM?
inMemory(clim)</code></pre>
<pre><code>## [1] FALSE</code></pre>
<pre class="r"><code>## How big is it?
object.size(clim)</code></pre>
<<<<<<< HEAD
<pre><code>## 245688 bytes</code></pre>
=======
<pre><code>## 248024 bytes</code></pre>
>>>>>>> 4f7979a4348b8de3b65c3af72c0aa4ff665e4020
<pre class="r"><code>## can we work with it directly in RAM?
canProcessInMemory(clim)</code></pre>
<pre><code>## [1] FALSE</code></pre>
</div>
<div id="subsetting-and-spatial-cropping" class="section level2">
<h2><span class="header-section-number">5.5</span> Subsetting and spatial cropping</h2>
<p>Use <code>[[1:3]]</code> to select raster layers from raster stack.</p>
<pre class="r"><code>## crop to a latitude/longitude box
r1 &lt;- crop(clim[[1]], extent(10,35,-35,-20))
## Crop using a Spatial polygon
r1 &lt;- crop(clim[[1]], bbox(za))</code></pre>
<pre class="r"><code>r1</code></pre>
<pre><code>## class       : RasterLayer 
## dimensions  : 76, 98, 7448  (nrow, ncol, ncell)
## resolution  : 0.1666667, 0.1666667  (x, y)
## extent      : 16.5, 32.83333, -34.83333, -22.16667  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
## data source : in memory
## names       : bio1 
## values      : 5.8, 24.6  (min, max)</code></pre>
<pre class="r"><code>plot(r1)</code></pre>
<p><img src="05_Raster_files/figure-html/unnamed-chunk-44-1.png" /><!-- --></p>
</div>
<div id="spatial-aggregation" class="section level2">
<h2><span class="header-section-number">5.6</span> Spatial aggregation</h2>
<pre class="r"><code>## aggregate using a function
aggregate(r1, 3, fun=mean) %&gt;%
  plot()</code></pre>
<p><img src="05_Raster_files/figure-html/unnamed-chunk-45-1.png" /><!-- --></p>
<div class="well">
<h2 id="your-turn-4"><span class="header-section-number">5.6</span> Your turn</h2>
<p>Create a new raster by aggregating to the minimum (<code>min</code>) value of <code>r1</code> within a 10 pixel window</p>
<button data-toggle="collapse" class="btn btn-primary btn-sm round" data-target="#demo3">
Show Solution
</button>
<div id="demo3" class="collapse">
<pre class="r"><code>aggregate(r1, 10, fun=min) %&gt;%
  plot()</code></pre>
<p><img src="05_Raster_files/figure-html/unnamed-chunk-46-1.png" /><!-- --></p>
</div>
</div>
</div>
<div id="focal-moving-window" class="section level2">
<h2><span class="header-section-number">5.7</span> Focal (“moving window”)</h2>
<pre class="r"><code>## apply a function over a moving window
focal(r1, w=matrix(1,3,3), fun=mean) %&gt;% 
  plot()</code></pre>
<p><img src="05_Raster_files/figure-html/unnamed-chunk-47-1.png" /><!-- --></p>
<pre class="r"><code>## apply a function over a moving window
rf_min &lt;- focal(r1, w=matrix(1,11,11), fun=min)
rf_max &lt;- focal(r1, w=matrix(1,11,11), fun=max)
rf_range=rf_max-rf_min

## or just use the range function
rf_range2 &lt;- focal(r1, w=matrix(1,11,11), fun=range)
plot(rf_range2)</code></pre>
<p><img src="05_Raster_files/figure-html/unnamed-chunk-48-1.png" /><!-- --></p>
<div class="well">
<h2 id="your-turn-5"><span class="header-section-number">5.7</span> Your turn</h2>
<p>Plot the focal standard deviation of <code>r1</code> over a 3x3 window.</p>
<button data-toggle="collapse" class="btn btn-primary btn-sm round" data-target="#demo4">
Show Solution
</button>
<div id="demo4" class="collapse">
<pre class="r"><code>focal(r1,w=matrix(1,3,3),fun=sd)%&gt;%
  plot()</code></pre>
<p><img src="05_Raster_files/figure-html/unnamed-chunk-49-1.png" /><!-- --></p>
</div>
</div>
</div>
<div id="raster-calculations" class="section level2">
<h2><span class="header-section-number">5.8</span> Raster calculations</h2>
<p>The <code>raster</code> package has many options for <em>raster algebra</em>, including <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, logical operators such as <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>==</code>, <code>!</code> and functions such as <code>abs</code>, <code>round</code>, <code>ceiling</code>, <code>floor</code>, <code>trunc</code>, <code>sqrt</code>, <code>log</code>, <code>log10</code>, <code>exp</code>, <code>cos</code>, <code>sin</code>, <code>max</code>, <code>min</code>, <code>range</code>, <code>prod</code>, <code>sum</code>, <code>any</code>, <code>all</code>.</p>
<p>So, for example, you can</p>
<pre class="r"><code>cellStats(r1,range)</code></pre>
<pre><code>## [1]  5.8 24.6</code></pre>
<pre class="r"><code>## add 10
s = r1 + 10
cellStats(s,range)</code></pre>
<pre><code>## [1] 15.8 34.6</code></pre>
<pre class="r"><code>## take the square root
s = sqrt(r1)
cellStats(s,range)</code></pre>
<pre><code>## [1] 2.408319 4.959839</code></pre>
<pre class="r"><code># round values
r = round(r1)
cellStats(r,range)</code></pre>
<pre><code>## [1]  6 25</code></pre>
<pre class="r"><code># find cells with values less than 15 degrees C
r = r1 &lt; 15
plot(r)</code></pre>
<p><img src="05_Raster_files/figure-html/unnamed-chunk-51-1.png" /><!-- --></p>
<div id="apply-algebraic-functions" class="section level3">
<h3><span class="header-section-number">5.8.1</span> Apply algebraic functions</h3>
<pre class="r"><code># multiply s times r and add 5
s = s * r1 + 5
cellStats(s,range)</code></pre>
<pre><code>## [1]  18.96825 127.01203</code></pre>
</div>
</div>
<div id="extracting-raster-data" class="section level2">
<h2><span class="header-section-number">5.9</span> Extracting Raster Data</h2>
<ul>
<li>points</li>
<li>lines</li>
<li>polygons</li>
<li>extent (rectangle)</li>
<li>cell numbers</li>
</ul>
<p>Extract all intersecting values OR apply a summarizing function with <code>fun</code>.</p>
<div id="point-data-1" class="section level3">
<h3><span class="header-section-number">5.9.1</span> Point data</h3>
<p><code>sampleRandom()</code> generates random points and automatically extracts the raster values for those points. Also check out <code>?sampleStratified</code> and <code>sampleRegular()</code>.</p>
<p>Generate 100 random points and the associated climate variables at those points.</p>
<pre class="r"><code>## define a new dataset of points to play with
pts=sampleRandom(clim,100,xy=T,sp=T)
plot(pts);axis(1);axis(2)</code></pre>
<p><img src="05_Raster_files/figure-html/unnamed-chunk-53-1.png" /><!-- --></p>
</div>
<div id="extract-data-using-a-spatialpoints-object" class="section level3">
<h3><span class="header-section-number">5.9.2</span> Extract data using a <code>SpatialPoints</code> object</h3>
<p>Often you will have some locations (points) for which you want data from a raster* object. You can use the <code>extract</code> function here with the <code>pts</code> object (we’ll pretend it’s a new point dataset for which you want climate variables).</p>
<pre class="r"><code>pts_data=raster::extract(clim[[1:4]],pts,df=T)
head(pts_data)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
<<<<<<< HEAD
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["ID"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["bio1"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["bio2"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["bio3"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["bio4"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"25.6","3":"15.1","4":"6.9","5":"139.8","_rn_":"1"},{"1":"2","2":"-1.3","3":"7.9","4":"2.5","5":"728.0","_rn_":"2"},{"1":"3","2":"-22.7","3":"7.3","4":"2.0","5":"1055.5","_rn_":"3"},{"1":"4","2":"-18.7","3":"7.1","4":"1.8","5":"1136.7","_rn_":"4"},{"1":"5","2":"-14.4","3":"6.7","4":"1.5","5":"1377.1","_rn_":"5"},{"1":"6","2":"8.2","3":"11.6","4":"2.9","5":"971.1","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
=======
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["ID"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["bio1"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["bio2"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["bio3"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["bio4"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"2.0","3":"6.7","4":"2.9","5":"574.4","_rn_":"1"},{"1":"2","2":"24.5","3":"10.0","4":"7.8","5":"63.0","_rn_":"2"},{"1":"3","2":"25.7","3":"8.5","4":"8.5","5":"41.3","_rn_":"3"},{"1":"4","2":"6.8","3":"14.5","4":"2.9","5":"1242.0","_rn_":"4"},{"1":"5","2":"12.9","3":"9.9","4":"3.0","5":"783.4","_rn_":"5"},{"1":"6","2":"23.1","3":"11.7","4":"5.8","5":"284.2","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
>>>>>>> 4f7979a4348b8de3b65c3af72c0aa4ff665e4020
  </script>
</div>
<blockquote>
<p>Use <code>package::function</code> to avoid confusion with similar functions.</p>
</blockquote>
</div>
<div id="plot-the-global-dataset-with-the-random-points" class="section level3">
<h3><span class="header-section-number">5.9.3</span> Plot the global dataset with the random points</h3>
<pre class="r"><code>plot(clim[[1]])
points(pts,col=&#39;red&#39;)</code></pre>
<p><img src="05_Raster_files/figure-html/unnamed-chunk-55-1.png" /><!-- --></p>
<!-- ### Summarize climate data at point locations -->
<!-- Use `gather()` to reshape the climate data for easy plotting with ggplot. -->
<!-- ```{r,warning=F} -->
<!-- d2=pts_data%>% -->
<!--   gather(ID) -->
<!-- colnames(d2)[1]="cell" -->
<!-- head(d2) -->
<!-- ``` -->
<!-- And plot density plots (like histograms). -->
<!-- ```{r} -->
<!-- ggplot(d2,aes(x=value))+ -->
<!--   geom_density()+ -->
<!--   facet_wrap(~ID,scales="free") -->
<!-- ``` -->
</div>
<div id="lines" class="section level3">
<h3><span class="header-section-number">5.9.4</span> Lines</h3>
<p>Extract values along a transect.</p>
<pre class="r"><code>transect = SpatialLinesDataFrame(
  SpatialLines(list(Lines(list(Line(
    rbind(c(19, -33.5),c(26, -33.5)))), ID = &quot;ZAF&quot;))),
  data.frame(Z = c(&quot;transect&quot;), row.names = c(&quot;ZAF&quot;)))

# OR

transect=SpatialLinesDataFrame(
  readWKT(&quot;LINESTRING(19 -33.5,26 -33.5)&quot;),
  data.frame(Z = c(&quot;transect&quot;)))


gplot(r1)+geom_tile(aes(fill=value))+
  geom_line(aes(x=long,y=lat),data=fortify(transect),col=&quot;red&quot;)</code></pre>
<p><img src="05_Raster_files/figure-html/unnamed-chunk-56-1.png" /><!-- --></p>
</div>
<div id="plot-transect" class="section level3">
<h3><span class="header-section-number">5.9.5</span> Plot Transect</h3>
<pre class="r"><code>trans=raster::extract(x=clim[[12:14]],
                      y=transect,
                      along=T,
                      cellnumbers=T)%&gt;%
  data.frame()
head(trans)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["cell"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["bio12"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["bio13"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["bio14"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"1601755","2":"81.4","3":"13.0","4":"2.0","_rn_":"1"},{"1":"1601756","2":"71.9","3":"11.6","4":"1.7","_rn_":"2"},{"1":"1601757","2":"56.8","3":"8.8","4":"1.5","_rn_":"3"},{"1":"1601758","2":"47.9","3":"7.2","4":"1.3","_rn_":"4"},{"1":"1601759","2":"41.5","3":"6.1","4":"1.3","_rn_":"5"},{"1":"1601760","2":"36.1","3":"5.0","4":"1.2","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div id="add-other-metadata-and-reshape" class="section level4">
<h4><span class="header-section-number">5.9.5.1</span> Add other metadata and reshape</h4>
<pre class="r"><code>trans[,c(&quot;lon&quot;,&quot;lat&quot;)]=coordinates(clim)[trans$cell]
trans$order=as.integer(rownames(trans))
head(trans)  </code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["cell"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["bio12"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["bio13"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["bio14"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["lon"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["lat"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["order"],"name":[7],"type":["int"],"align":["right"]}],"data":[{"1":"1601755","2":"81.4","3":"13.0","4":"2.0","5":"19.08333","6":"19.08333","7":"1","_rn_":"1"},{"1":"1601756","2":"71.9","3":"11.6","4":"1.7","5":"19.25000","6":"19.25000","7":"2","_rn_":"2"},{"1":"1601757","2":"56.8","3":"8.8","4":"1.5","5":"19.41667","6":"19.41667","7":"3","_rn_":"3"},{"1":"1601758","2":"47.9","3":"7.2","4":"1.3","5":"19.58333","6":"19.58333","7":"4","_rn_":"4"},{"1":"1601759","2":"41.5","3":"6.1","4":"1.3","5":"19.75000","6":"19.75000","7":"5","_rn_":"5"},{"1":"1601760","2":"36.1","3":"5.0","4":"1.2","5":"19.91667","6":"19.91667","7":"6","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>transl=group_by(trans,lon,lat)%&gt;%
  gather(variable, value, -lon, -lat, -cell, -order)
head(transl)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["cell"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["lon"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["lat"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["order"],"name":[4],"type":["int"],"align":["right"]},{"label":["variable"],"name":[5],"type":["chr"],"align":["left"]},{"label":["value"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"1601755","2":"19.08333","3":"19.08333","4":"1","5":"bio12","6":"81.4"},{"1":"1601756","2":"19.25000","3":"19.25000","4":"2","5":"bio12","6":"71.9"},{"1":"1601757","2":"19.41667","3":"19.41667","4":"3","5":"bio12","6":"56.8"},{"1":"1601758","2":"19.58333","3":"19.58333","4":"4","5":"bio12","6":"47.9"},{"1":"1601759","2":"19.75000","3":"19.75000","4":"5","5":"bio12","6":"41.5"},{"1":"1601760","2":"19.91667","3":"19.91667","4":"6","5":"bio12","6":"36.1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>ggplot(transl,aes(x=lon,y=value,
                  colour=variable,
                  group=variable,
                  order=order))+
  geom_line()</code></pre>
<p><img src="05_Raster_files/figure-html/unnamed-chunk-60-1.png" /><!-- --></p>
<!-- ### _Zonal_ statistics -->
<!-- Calculate mean annual temperature averaged by province (polygons). -->
<!-- ```{r} -->
<!-- rsp=raster::extract(x=r1, -->
<!--                     y=za, -->
<!--                     fun=mean, -->
<!--                     sp=T) -->
<!-- #spplot(rsp,zcol="bio1") -->
<!-- ``` -->
<!-- ```{r,eval=FALSE} -->
<!-- ## add the ID to the dataframe itself for easier indexing in the map -->
<!-- rsp$id=as.numeric(rownames(rsp@data)) -->
<!-- ## create fortified version for plotting with ggplot() -->
<!-- frsp=fortify(rsp,region="id") -->
<!-- ggplot(rsp@data, aes(map_id = id, fill=bio1)) + -->
<!--     expand_limits(x = frsp$long, y = frsp$lat)+ -->
<!--     scale_fill_gradientn( -->
<!--       colours = c("grey","goldenrod","darkgreen","green"))+ -->
<!--     coord_map()+ -->
<!--     geom_map(map = frsp) -->
<!-- ``` -->
<!-- <img src="05_assets/slow_zonal_plot.png" alt="alt text" width="75%">  -->
<!-- > Not a very exciting plot, but then again, we did just ask for the mean value across the province. For more details about plotting spatialPolygons, see [here](https://github.com/hadley/ggplot2/wiki/plotting-polygon-shapefiles) -->
</div>
</div>
</div>
<div id="example-workflow" class="section level2">
<h2><span class="header-section-number">5.10</span> Example Workflow</h2>
<ol style="list-style-type: decimal">
<li>Download the Maximum Temperature dataset using <code>getData()</code></li>
<li>Set the gain to 0.1 (to convert to degrees Celcius)</li>
<li>Crop it to the country you downloaded (or ZA?)</li>
<li>Calculate the overall range for each variable with <code>cellStats()</code></li>
<li>Calculate the focal median with an 11x11 window with <code>focal()</code></li>
<li>Create a transect across the region and extract the temperature data.</li>
</ol>
<pre class="r"><code>country=getData(&#39;GADM&#39;, country=&#39;TUN&#39;, level=1)
tmax=getData(&#39;worldclim&#39;, var=&#39;tmax&#39;, res=10)
gain(tmax)=0.1
names(tmax)</code></pre>
<pre><code>##  [1] &quot;tmax1&quot;  &quot;tmax2&quot;  &quot;tmax3&quot;  &quot;tmax4&quot;  &quot;tmax5&quot;  &quot;tmax6&quot;  &quot;tmax7&quot; 
##  [8] &quot;tmax8&quot;  &quot;tmax9&quot;  &quot;tmax10&quot; &quot;tmax11&quot; &quot;tmax12&quot;</code></pre>
<p>Default layer names can be problematic/undesirable.</p>
<pre class="r"><code>sort(names(tmax))</code></pre>
<pre><code>##  [1] &quot;tmax1&quot;  &quot;tmax10&quot; &quot;tmax11&quot; &quot;tmax12&quot; &quot;tmax2&quot;  &quot;tmax3&quot;  &quot;tmax4&quot; 
##  [8] &quot;tmax5&quot;  &quot;tmax6&quot;  &quot;tmax7&quot;  &quot;tmax8&quot;  &quot;tmax9&quot;</code></pre>
<pre class="r"><code>## Options
month.name</code></pre>
<pre><code>##  [1] &quot;January&quot;   &quot;February&quot;  &quot;March&quot;     &quot;April&quot;     &quot;May&quot;      
##  [6] &quot;June&quot;      &quot;July&quot;      &quot;August&quot;    &quot;September&quot; &quot;October&quot;  
## [11] &quot;November&quot;  &quot;December&quot;</code></pre>
<pre class="r"><code>month.abb</code></pre>
<pre><code>##  [1] &quot;Jan&quot; &quot;Feb&quot; &quot;Mar&quot; &quot;Apr&quot; &quot;May&quot; &quot;Jun&quot; &quot;Jul&quot; &quot;Aug&quot; &quot;Sep&quot; &quot;Oct&quot; &quot;Nov&quot;
## [12] &quot;Dec&quot;</code></pre>
<pre class="r"><code>sprintf(&quot;%02d&quot;,1:12)</code></pre>
<pre><code>##  [1] &quot;01&quot; &quot;02&quot; &quot;03&quot; &quot;04&quot; &quot;05&quot; &quot;06&quot; &quot;07&quot; &quot;08&quot; &quot;09&quot; &quot;10&quot; &quot;11&quot; &quot;12&quot;</code></pre>
<pre class="r"><code>sprintf(&quot;%04d&quot;,1:12)</code></pre>
<pre><code>##  [1] &quot;0001&quot; &quot;0002&quot; &quot;0003&quot; &quot;0004&quot; &quot;0005&quot; &quot;0006&quot; &quot;0007&quot; &quot;0008&quot; &quot;0009&quot; &quot;0010&quot;
## [11] &quot;0011&quot; &quot;0012&quot;</code></pre>
<p>See <code>?sprintf</code> for details</p>
<pre class="r"><code>names(tmax)=sprintf(&quot;%02d&quot;,1:12)

tmax_crop=crop(tmax,country)
tmaxave_crop=mean(tmax_crop)  # calculate mean annual maximum temperature 
tmaxavefocal_crop=focal(tmaxave_crop,
                        fun=median,
                        w=matrix(1,11,11))</code></pre>
<blockquote>
<p>Only a few datasets are available usig <code>getData()</code> in the raster package, but you can download almost any file on the web with <code>file.download()</code>.</p>
</blockquote>
<p>Report quantiles for each layer in a raster* object</p>
<pre class="r"><code>cellStats(tmax_crop,&quot;quantile&quot;)</code></pre>
<pre><code>##       X01  X02  X03  X04  X05  X06  X07  X08  X09  X10  X11  X12
## 0%    8.4 10.1 13.8 17.4 21.9 26.4 29.6 30.3 26.6 19.7 14.1  9.6
## 25%  14.1 15.8 18.3 21.3 25.7 30.4 34.6 34.0 30.3 25.3 20.2 15.4
## 50%  15.3 17.4 21.0 25.0 28.9 33.3 36.4 35.8 32.8 27.6 21.7 16.6
## 75%  16.3 19.0 23.0 27.4 31.9 36.4 39.7 39.0 35.3 29.0 22.4 17.4
## 100% 18.1 21.2 25.6 31.2 35.9 41.4 43.3 42.6 38.5 31.9 24.5 18.9</code></pre>
</div>
<div id="create-a-transect-spatiallinesdataframe" class="section level2">
<h2><span class="header-section-number">5.11</span> Create a Transect (SpatialLinesDataFrame)</h2>
<pre class="r"><code>transect=SpatialLinesDataFrame(
  readWKT(&quot;LINESTRING(8 36,10 36)&quot;),
  data.frame(Z = c(&quot;T1&quot;)))</code></pre>
</div>
<div id="plot-the-timeseries-of-climate-data" class="section level2">
<h2><span class="header-section-number">5.12</span> Plot the timeseries of climate data</h2>
<pre class="r"><code>gplot(tmax_crop)+
  geom_tile(aes(fill=value))+
  scale_fill_gradientn(
    colours=c(&quot;brown&quot;,&quot;red&quot;,&quot;yellow&quot;,&quot;darkgreen&quot;,&quot;green&quot;),
    name=&quot;Temp&quot;)+
  facet_wrap(~variable)+
  ## now add country overlays
  geom_path(data=fortify(country),
            mapping=aes(x=long,y=lat,
                        group=group,
                        order=order))+
  # now add transect line
  geom_line(aes(x=long,y=lat),
            data=fortify(transect),col=&quot;red&quot;,size=3)+
  coord_map()</code></pre>
<p><img src="05_assets/slow_time_series_plot.png" alt="alt text" width="75%"></p>
</div>
<div id="extract-and-clean-up-the-transect-data" class="section level2">
<h2><span class="header-section-number">5.13</span> Extract and clean up the transect data</h2>
<pre class="r"><code>trans=raster::extract(tmax_crop,
                      transect,
                      along=T,
                      cellnumbers=T)%&gt;% 
  as.data.frame()
trans[,c(&quot;lon&quot;,&quot;lat&quot;)]=coordinates(tmax_crop)[trans$cell]
trans$order=as.integer(rownames(trans))
head(trans)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["cell"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["X01"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["X02"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["X03"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["X04"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["X05"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["X06"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["X07"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["X08"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["X09"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["X10"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["X11"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["X12"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["lon"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["lat"],"name":[15],"type":["dbl"],"align":["right"]},{"label":["order"],"name":[16],"type":["int"],"align":["right"]}],"data":[{"1":"229","2":"12.0","3":"13.3","4":"16.7","5":"20.4","6":"24.5","7":"30.4","8":"34.5","9":"33.9","10":"29.4","11":"23.0","12":"17.3","13":"13.0","14":"8.083333","15":"8.083333","16":"1","_rn_":"1"},{"1":"230","2":"12.6","3":"14.1","4":"17.4","5":"21.1","6":"25.3","7":"31.4","8":"35.5","9":"34.9","10":"30.3","11":"23.8","12":"18.0","13":"13.8","14":"8.250000","15":"8.250000","16":"2","_rn_":"2"},{"1":"231","2":"12.8","3":"14.3","4":"17.6","5":"21.3","6":"25.6","7":"31.8","8":"36.1","9":"35.4","10":"30.7","11":"24.1","12":"18.2","13":"14.0","14":"8.416667","15":"8.416667","16":"3","_rn_":"3"},{"1":"232","2":"11.8","3":"13.3","4":"16.8","5":"20.6","6":"25.0","7":"31.1","8":"35.7","9":"34.8","10":"30.0","11":"23.4","12":"17.4","13":"13.1","14":"8.583333","15":"8.583333","16":"4","_rn_":"4"},{"1":"233","2":"11.6","3":"13.1","4":"16.6","5":"20.4","6":"25.0","7":"30.9","8":"35.7","9":"34.7","10":"29.9","11":"23.3","12":"17.4","13":"13.0","14":"8.750000","15":"8.750000","16":"5","_rn_":"5"},{"1":"234","2":"11.3","3":"12.7","4":"16.3","5":"20.0","6":"24.8","7":"30.5","8":"35.4","9":"34.4","10":"29.6","11":"23.2","12":"17.3","13":"12.8","14":"8.916667","15":"8.916667","16":"6","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Reformat to ‘long’ format.</p>
<pre class="r"><code>transl=group_by(trans,lon,lat)%&gt;%
  gather(variable, value, -lon, -lat, -cell, -order)%&gt;%
  separate(variable,into = c(&quot;X&quot;,&quot;month&quot;),1)%&gt;%
  mutate(month=as.numeric(month),monthname=factor(month.name[month],ordered=T,levels=month.name))
head(transl)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["cell"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["lon"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["lat"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["order"],"name":[4],"type":["int"],"align":["right"]},{"label":["X"],"name":[5],"type":["chr"],"align":["left"]},{"label":["month"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["value"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["monthname"],"name":[8],"type":["ord"],"align":["right"]}],"data":[{"1":"229","2":"8.083333","3":"8.083333","4":"1","5":"X","6":"1","7":"12.0","8":"January"},{"1":"230","2":"8.250000","3":"8.250000","4":"2","5":"X","6":"1","7":"12.6","8":"January"},{"1":"231","2":"8.416667","3":"8.416667","4":"3","5":"X","6":"1","7":"12.8","8":"January"},{"1":"232","2":"8.583333","3":"8.583333","4":"4","5":"X","6":"1","7":"11.8","8":"January"},{"1":"233","2":"8.750000","3":"8.750000","4":"5","5":"X","6":"1","7":"11.6","8":"January"},{"1":"234","2":"8.916667","3":"8.916667","4":"6","5":"X","6":"1","7":"11.3","8":"January"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="plot-the-transect-data" class="section level2">
<h2><span class="header-section-number">5.14</span> Plot the transect data</h2>
<pre class="r"><code>ggplot(transl,
       aes(x=lon,y=value,
           colour=month,
           group=month,
           order=order))+
  ylab(&quot;Maximum Temp&quot;)+
    scale_color_gradientn(
      colors=c(&quot;blue&quot;,&quot;green&quot;,&quot;red&quot;),
      name=&quot;Month&quot;)+
    geom_line()</code></pre>
<p><img src="05_Raster_files/figure-html/unnamed-chunk-69-1.png" /><!-- --></p>
<p>Or the same data in a levelplot:</p>
<pre class="r"><code>ggplot(transl,
       aes(x=lon,y=monthname,
           fill=value))+
  ylab(&quot;Month&quot;)+
    scale_fill_distiller(
      palette=&quot;PuBuGn&quot;,
      name=&quot;Tmax&quot;)+
    geom_raster()</code></pre>
<p><img src="05_Raster_files/figure-html/unnamed-chunk-70-1.png" /><!-- --></p>
<!--
## Raster Processing

Things to consider:

* RAM limitations
* Disk space and temporary files
* Use of external programs (e.g. GDAL)
* Use of external GIS viewer (e.g. QGIS)
-->
</div>
</div>
<div id="sf-package" class="section level1">
<h1><span class="header-section-number">6</span> sf Package</h1>
<p><img src="05_assets/sf.jpg" alt="alt text" width="70%"></p>
<div id="why-sf" class="section level2">
<h2><span class="header-section-number">6.1</span> Why sf?</h2>
<p>The <code>sf</code> package is a fairly new (~2 years) tool for the handling and processing of shapefiles and other vector data. Why use sf when there are several other packages with similar functionality? Three very good reasons to do so:</p>
<ul>
<li>integration</li>
<li>piping</li>
<li>speed</li>
</ul>
</div>
<div id="integration" class="section level2">
<h2><span class="header-section-number">6.2</span> Integration</h2>
<p><code>sf</code> treats spatial objects as a special type of data frame. This is a familiar type of data format to most R users, and can be manipulated as such. Each row of the data frame corresponds to a particular geometry (e.g., polygon or point) and each column corresponds to a particular attribute of the data.</p>
<pre class="r"><code>countries &lt;- st_read(&quot;World/TM_WORLD_BORDERS.shp&quot;)</code></pre>
<pre><code>## Reading layer `TM_WORLD_BORDERS&#39; from data source `/Users/darwin/Dropbox/GitHub/YaleBGCCourses/World/TM_WORLD_BORDERS.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 242 features and 12 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -180 ymin: -90 xmax: 180 ymax: 83.6236
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs</code></pre>
<pre class="r"><code>head(countries)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["ISO3"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["FIPS"],"name":[2],"type":["fctr"],"align":["left"]},{"label":["ISO2"],"name":[3],"type":["fctr"],"align":["left"]},{"label":["UN"],"name":[4],"type":["int"],"align":["right"]},{"label":["NAME"],"name":[5],"type":["fctr"],"align":["left"]},{"label":["AREA"],"name":[6],"type":["int"],"align":["right"]},{"label":["POP2005"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["REGION"],"name":[8],"type":["int"],"align":["right"]},{"label":["LON"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["LAT"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["SUBREGION"],"name":[11],"type":["int"],"align":["right"]},{"label":["SUBREGION_"],"name":[12],"type":["fctr"],"align":["left"]},{"label":["geometry"],"name":[13],"type":["S3: sfc_MULTIPOLYGON"],"align":["right"]}],"data":[{"1":"ABW","2":"AA","3":"AW","4":"533","5":"Aruba","6":"0","7":"102897","8":"19","9":"-69.977","10":"12.517","11":"419","12":"Latin America and the Caribbean","13":"<S3: sfc_MULTIPOLYGON>","_rn_":"1"},{"1":"AFG","2":"AF","3":"AF","4":"4","5":"Afghanistan","6":"65209","7":"25067407","8":"142","9":"65.216","10":"33.677","11":"34","12":"Southern Asia","13":"<S3: sfc_MULTIPOLYGON>","_rn_":"2"},{"1":"AGO","2":"AO","3":"AO","4":"24","5":"Angola","6":"124670","7":"16095214","8":"2","9":"17.544","10":"-12.296","11":"202","12":"Sub-Saharan Africa","13":"<S3: sfc_MULTIPOLYGON>","_rn_":"3"},{"1":"AIA","2":"AV","3":"AI","4":"660","5":"Anguilla","6":"0","7":"12256","8":"19","9":"-63.032","10":"18.237","11":"419","12":"Latin America and the Caribbean","13":"<S3: sfc_MULTIPOLYGON>","_rn_":"4"},{"1":"ALA","2":"NA","3":"AX","4":"248","5":"Åland Islands","6":"0","7":"0","8":"150","9":"19.952","10":"60.198","11":"154","12":"Northern Europe","13":"<S3: sfc_MULTIPOLYGON>","_rn_":"5"},{"1":"ALB","2":"AL","3":"AL","4":"8","5":"Albania","6":"2740","7":"3153731","8":"150","9":"20.068","10":"41.143","11":"39","12":"Southern Europe","13":"<S3: sfc_MULTIPOLYGON>","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><code>sf</code> integrates well with packages in the Hadleyverse (e.g., <code>ggplot2</code>, <code>dplyr</code>, <code>tidyr</code>, etc.). Spatial objects can be manipulated and summarized in the same way as data frames.</p>
<pre class="r"><code>we &lt;- filter(countries, SUBREGION_ == &quot;Western Europe&quot;)
plot(we[&#39;NAME&#39;])</code></pre>
<p><img src="05_Raster_files/figure-html/unnamed-chunk-73-1.png" /><!-- --></p>
<p>Everything you need is integrated into one package: reading, writing, and geometric manipulations can all be done directly with <code>sf</code> functions. An entire separate library of different spatial S4 object classes (e.g., <code>SpatialPolygons</code>, <code>SpatialPoints</code>, <code>SpatialLines</code> in the <code>sp</code> package) is no longer needed.</p>
</div>
<div id="piping" class="section level2">
<h2><span class="header-section-number">6.3</span> Piping</h2>
<p><code>sf</code> really shines with piping.</p>
<pre class="r"><code># calculate population density of each subregion
pop.dens &lt;- countries %&gt;%
  group_by(SUBREGION_) %&gt;%
  summarise(Population = sum(POP2005),
            Area = sum(AREA),
            Density = Population/Area, 
            do_union = F)
pop.dens</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["SUBREGION_"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["Population"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Area"],"name":[3],"type":["int"],"align":["right"]},{"label":["Density"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["geometry"],"name":[5],"type":["S3: sfc_MULTIPOLYGON"],"align":["right"]}],"data":[{"1":"Australia and New Zealand","2":"24407320","3":"795030","4":"30.69987","5":"<S3: sfc_MULTIPOLYGON>"},{"1":"Central Asia","2":"58390758","3":"392679","4":"148.69845","5":"<S3: sfc_MULTIPOLYGON>"},{"1":"Eastern Asia","2":"1514941747","3":"1147757","4":"1319.91506","5":"<S3: sfc_MULTIPOLYGON>"},{"1":"Eastern Europe","2":"297775434","3":"1806489","4":"164.83656","5":"<S3: sfc_MULTIPOLYGON>"},{"1":"Latin America and the Caribbean","2":"511045107","3":"2017933","4":"253.25177","5":"<S3: sfc_MULTIPOLYGON>"},{"1":"Melanesia","2":"7819731","3":"52959","4":"147.65632","5":"<S3: sfc_MULTIPOLYGON>"},{"1":"Micronesia","2":"335086","3":"200","4":"1675.43000","5":"<S3: sfc_MULTIPOLYGON>"},{"1":"Northern Africa","2":"189562020","3":"811439","4":"233.61216","5":"<S3: sfc_MULTIPOLYGON>"},{"1":"Northern America","2":"332244951","3":"1866297","4":"178.02362","5":"<S3: sfc_MULTIPOLYGON>"},{"1":"Northern Europe","2":"96221438","3":"164179","4":"586.07640","5":"<S3: sfc_MULTIPOLYGON>"},{"1":"Polynesia","2":"645431","3":"809","4":"797.81335","5":"<S3: sfc_MULTIPOLYGON>"},{"1":"South-eastern Asia","2":"552571494","3":"436035","4":"1267.26408","5":"<S3: sfc_MULTIPOLYGON>"},{"1":"Southern Asia","2":"1449446587","3":"641746","4":"2258.59855","5":"<S3: sfc_MULTIPOLYGON>"},{"1":"Southern Europe","2":"93425671","3":"119396","4":"782.48577","5":"<S3: sfc_MULTIPOLYGON>"},{"1":"Sub-Saharan Africa","2":"679185941","3":"2124579","4":"319.68025","5":"<S3: sfc_MULTIPOLYGON>"},{"1":"Western Asia","2":"184530104","3":"480078","4":"384.37526","5":"<S3: sfc_MULTIPOLYGON>"},{"1":"Western Europe","2":"171881635","3":"105554","4":"1628.37633","5":"<S3: sfc_MULTIPOLYGON>"},{"1":"NA","2":"0","3":"0","4":"NaN","5":"<S3: sfc_MULTIPOLYGON>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>plot(pop.dens[&#39;Density&#39;])</code></pre>
<p><img src="05_Raster_files/figure-html/unnamed-chunk-74-1.png" /><!-- --></p>
<pre class="r"><code># pull out Canada multipolygon, split into individual polygons
canada &lt;- countries %&gt;%
  filter(NAME == &quot;Canada&quot;) %&gt;%
  st_cast(&quot;POLYGON&quot;) %&gt;%
  mutate(ID = row_number())</code></pre>
<pre><code>## Warning in st_cast.sf(., &quot;POLYGON&quot;): repeating attributes for all sub-
## geometries for which they may not be constant</code></pre>
<pre class="r"><code>plot(canada[&#39;ID&#39;])</code></pre>
<p><img src="05_Raster_files/figure-html/unnamed-chunk-75-1.png" /><!-- --></p>
</div>
<div id="speed" class="section level2">
<h2><span class="header-section-number">6.4</span> Speed</h2>
<p><code>sf</code> is <em>much</em> faster at reading and performing spatial tasks.</p>
<pre class="r"><code>library(microbenchmark)

test.sf &lt;- microbenchmark(
  st_read(&quot;World/TM_WORLD_BORDERS.shp&quot;, quiet = T), 
  times = 5)
test.sp &lt;- microbenchmark(
  rgdal::readOGR(&quot;World/TM_WORLD_BORDERS.shp&quot;, verbose = F),
  times = 5)

print(rbind(test.sf, test.sp))</code></pre>
<pre><code>## Unit: milliseconds
##                                                       expr       min
##           st_read(&quot;World/TM_WORLD_BORDERS.shp&quot;, quiet = T)  28.18283
##  rgdal::readOGR(&quot;World/TM_WORLD_BORDERS.shp&quot;, verbose = F) 761.96160
##         lq      mean    median        uq       max neval
##   28.25744  31.41285  28.73009  30.58042  41.31348     5
##  774.38748 783.03476 788.61361 790.25213 799.95897     5</code></pre>
</div>
<div id="some-familiar-functions" class="section level2">
<h2><span class="header-section-number">6.5</span> Some familiar functions</h2>
<p>Lots of functionality:</p>
<ul>
<li>Unions and intersections:
<ul>
<li><code>st_union</code></li>
<li><code>st_difference</code></li>
<li><code>st_intersection</code></li>
</ul></li>
<li>Changing and setting projections:
<ul>
<li><code>st_crs</code></li>
<li><code>st_transform</code></li>
</ul></li>
<li>Spatial manipulation:
<ul>
<li><code>st_buffer</code></li>
<li><code>st_convex_hull</code></li>
<li><code>st_centroid</code></li>
</ul></li>
<li>Data manipulation:
<ul>
<li><code>filter</code></li>
<li><code>group_by</code></li>
<li><code>mutate</code></li>
<li><code>select</code></li>
<li><code>summarise</code></li>
<li><code>gather</code></li>
<li><code>spread</code></li>
</ul></li>
<li>Much more!</li>
</ul>
</div>
<div id="limitations-and-compatibility" class="section level2">
<h2><span class="header-section-number">6.6</span> Limitations and compatibility</h2>
<p><code>sf</code> is fairly new, and several other spatial packages have not yet been updated to integrate with it. Some may never be updated. When working with other packages, it may be necessary to convert <code>sf</code> objects into <code>Spatial</code> objects for backward compatibility.</p>
<pre class="r"><code>class(countries)</code></pre>
<pre><code>## [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre>
<pre class="r"><code>countries.sp &lt;- as(countries, &quot;Spatial&quot;)
class(countries.sp)</code></pre>
<pre><code>## [1] &quot;SpatialPolygonsDataFrame&quot;
## attr(,&quot;package&quot;)
## [1] &quot;sp&quot;</code></pre>
<p>The <code>raster</code> package contains methods for <code>sf</code> objects; <code>rasterVis</code> currently does not, but that is likely to change in the near future.</p>
<p>The <code>lwgeom</code> package extends <code>sf</code> functionality and provides several tools for geodetic calculations (i.e., spherical and ellipsoidal geometry).</p>
</div>
</div>


<!-- give the footer some space -->
<br/>
<br/>

<footer id="site-footer">
  <div id="footer1">
  <a href="https://cmerow.github.io"><img src="img/cory.png" alt="logo" width=40px></a>
  <!--
  <a href="http://adamwilson.us/#contact"><i class="fa fa-envelope fa-2x"></i></a> 
  <a href="https://twitter.com/AdamWilsonLab"><i class="fa fa-twitter fa-2x"></i></a> 
  <a href="https://github.com/AdamMWilson"><i class="fa fa-github fa-2x"></i></a>
  -->
  </div>
  <div id="footer2">
  <a rel="license" property="http://creativecommons.org/ns#license"
  href="http://creativecommons.org/licenses/by/4.0/" ><img src="img/cc-by.svg" alt="cc-by"/></a> 
  </div>
</footer>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>


</body>
</html>
